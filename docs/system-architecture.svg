<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- Define gradients -->
    <linearGradient id="clientGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4CAF50;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#45a049;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="mcpGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#2196F3;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1976D2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="webGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FF9800;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#F57C00;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="dataGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#9C27B0;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7B1FA2;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="soarGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#E91E63;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#C2185B;stop-opacity:1" />
    </linearGradient>

    <!-- Define shadow filter -->
    <filter id="dropshadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="3" dy="3" stdDeviation="3" flood-color="#00000030"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="1200" height="800" fill="#f8f9fa" stroke="none"/>

  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#333">
    SOAR MCP Server System Architecture
  </text>

  <!-- Client Layer -->
  <g transform="translate(50, 70)">
    <rect x="0" y="0" width="1100" height="100" fill="url(#clientGradient)" rx="10" filter="url(#dropshadow)"/>
    <text x="550" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">
      Client Layer
    </text>

    <!-- AI clients -->
    <g transform="translate(50, 35)">
      <rect x="0" y="0" width="150" height="50" fill="white" rx="5" stroke="#4CAF50" stroke-width="2"/>
      <text x="75" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Claude Desktop</text>
      <text x="75" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Cherry Studio</text>
    </g>

    <g transform="translate(250, 35)">
      <rect x="0" y="0" width="150" height="50" fill="white" rx="5" stroke="#4CAF50" stroke-width="2"/>
      <text x="75" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Other MCP Clients</text>
      <text x="75" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">(AI Applications)</text>
    </g>

    <g transform="translate(750, 35)">
      <rect x="0" y="0" width="150" height="50" fill="white" rx="5" stroke="#4CAF50" stroke-width="2"/>
      <text x="75" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Web Administrator</text>
      <text x="75" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">(Admin Portal)</text>
    </g>

    <g transform="translate(950, 35)">
      <rect x="0" y="0" width="100" height="50" fill="white" rx="5" stroke="#4CAF50" stroke-width="2"/>
      <text x="50" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">REST API</text>
      <text x="50" y="40" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#333">Clients</text>
    </g>
  </g>

  <!-- Connection lines: Client to Server Layer -->
  <line x1="175" y1="170" x2="175" y2="200" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="375" y1="170" x2="375" y2="200" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="875" y1="170" x2="875" y2="200" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="1050" y1="170" x2="1050" y2="200" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Dual Server Layer -->
  <g transform="translate(50, 200)">
    <!-- MCP Server -->
    <g transform="translate(0, 0)">
      <rect x="0" y="0" width="500" height="120" fill="url(#mcpGradient)" rx="10" filter="url(#dropshadow)"/>
      <text x="250" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">
        MCP Server (Port: 12345)
      </text>

      <!-- MCP tools -->
      <g transform="translate(20, 35)">
        <rect x="0" y="0" width="120" height="30" fill="white" rx="3" stroke="#2196F3" stroke-width="1"/>
        <text x="60" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">list_playbooks_quick</text>
      </g>

      <g transform="translate(150, 35)">
        <rect x="0" y="0" width="120" height="30" fill="white" rx="3" stroke="#2196F3" stroke-width="1"/>
        <text x="60" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">execute_playbook</text>
      </g>

      <g transform="translate(280, 35)">
        <rect x="0" y="0" width="120" height="30" fill="white" rx="3" stroke="#2196F3" stroke-width="1"/>
        <text x="60" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">query_execution_status</text>
      </g>

      <g transform="translate(410, 35)">
        <rect x="0" y="0" width="70" height="30" fill="white" rx="3" stroke="#2196F3" stroke-width="1"/>
        <text x="35" y="15" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#333">More Tools</text>
        <text x="35" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#333">...</text>
      </g>

      <text x="250" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">
        FastMCP Framework - Standard MCP Protocol
      </text>
      <text x="250" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">
        Security Orchestration for AI Clients
      </text>
    </g>

    <!-- Web Management Server -->
    <g transform="translate(550, 0)">
      <rect x="0" y="0" width="500" height="120" fill="url(#webGradient)" rx="10" filter="url(#dropshadow)"/>
      <text x="250" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">
        Web Management Server (Port: 12346)
      </text>

      <!-- Web features -->
      <g transform="translate(20, 35)">
        <rect x="0" y="0" width="100" height="30" fill="white" rx="3" stroke="#FF9800" stroke-width="1"/>
        <text x="50" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">Configuration</text>
      </g>

      <g transform="translate(130, 35)">
        <rect x="0" y="0" width="100" height="30" fill="white" rx="3" stroke="#FF9800" stroke-width="1"/>
        <text x="50" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">Dashboard</text>
      </g>

      <g transform="translate(240, 35)">
        <rect x="0" y="0" width="100" height="30" fill="white" rx="3" stroke="#FF9800" stroke-width="1"/>
        <text x="50" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">Log Viewer</text>
      </g>

      <g transform="translate(350, 35)">
        <rect x="0" y="0" width="100" height="30" fill="white" rx="3" stroke="#FF9800" stroke-width="1"/>
        <text x="50" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#333">REST API</text>
      </g>

      <text x="250" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">
        Flask Framework - Web Management Interface
      </text>
      <text x="250" y="105" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="white">
        System Configuration, Monitoring & Operations
      </text>
    </g>
  </g>

  <!-- Connection lines: Server to Business Logic Layer -->
  <line x1="300" y1="320" x2="300" y2="360" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="800" y1="320" x2="800" y2="360" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Business Logic Layer -->
  <g transform="translate(50, 360)">
    <rect x="0" y="0" width="1100" height="120" fill="url(#dataGradient)" rx="10" filter="url(#dropshadow)"/>
    <text x="550" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">
      Business Logic Layer
    </text>

    <!-- Core components -->
    <g transform="translate(50, 35)">
      <rect x="0" y="0" width="150" height="70" fill="white" rx="5" stroke="#9C27B0" stroke-width="2"/>
      <text x="75" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Authentication</text>
      <text x="75" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">JWT Auth</text>
      <text x="75" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Access Control</text>
      <text x="75" y="65" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Audit Logs</text>
    </g>

    <g transform="translate(220, 35)">
      <rect x="0" y="0" width="150" height="70" fill="white" rx="5" stroke="#9C27B0" stroke-width="2"/>
      <text x="75" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Playbook Manager</text>
      <text x="75" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Playbook Query</text>
      <text x="75" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Parameter Mgmt</text>
      <text x="75" y="65" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Lifecycle</text>
    </g>

    <g transform="translate(390, 35)">
      <rect x="0" y="0" width="150" height="70" fill="white" rx="5" stroke="#9C27B0" stroke-width="2"/>
      <text x="75" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Execution Engine</text>
      <text x="75" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Playbook Exec</text>
      <text x="75" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Status Monitor</text>
      <text x="75" y="65" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Result Handler</text>
    </g>

    <g transform="translate(560, 35)">
      <rect x="0" y="0" width="150" height="70" fill="white" rx="5" stroke="#9C27B0" stroke-width="2"/>
      <text x="75" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Sync Service</text>
      <text x="75" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Incremental Sync</text>
      <text x="75" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Scheduled Tasks</text>
      <text x="75" y="65" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Data Validation</text>
    </g>

    <g transform="translate(730, 35)">
      <rect x="0" y="0" width="150" height="70" fill="white" rx="5" stroke="#9C27B0" stroke-width="2"/>
      <text x="75" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Config Manager</text>
      <text x="75" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Persistence</text>
      <text x="75" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Dynamic Config</text>
      <text x="75" y="65" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Cache Mgmt</text>
    </g>

    <g transform="translate(900, 35)">
      <rect x="0" y="0" width="150" height="70" fill="white" rx="5" stroke="#9C27B0" stroke-width="2"/>
      <text x="75" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Logger</text>
      <text x="75" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Log Recording</text>
      <text x="75" y="50" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Log Analysis</text>
      <text x="75" y="65" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Alert Monitor</text>
    </g>
  </g>

  <!-- Connection lines: Business Logic to Data & External Systems -->
  <line x1="400" y1="480" x2="400" y2="520" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="800" y1="480" x2="800" y2="520" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)"/>

  <!-- Data Storage Layer -->
  <g transform="translate(50, 520)">
    <rect x="0" y="0" width="450" height="100" fill="#6c757d" rx="10" filter="url(#dropshadow)"/>
    <text x="225" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">
      Data Storage Layer
    </text>

    <g transform="translate(50, 35)">
      <rect x="0" y="0" width="100" height="50" fill="white" rx="5" stroke="#6c757d" stroke-width="2"/>
      <text x="50" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">SQLite</text>
      <text x="50" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">(Default)</text>
    </g>

    <g transform="translate(175, 35)">
      <rect x="0" y="0" width="100" height="50" fill="white" rx="5" stroke="#6c757d" stroke-width="2"/>
      <text x="50" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">PostgreSQL</text>
      <text x="50" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">(Optional)</text>
    </g>

    <g transform="translate(300, 35)">
      <rect x="0" y="0" width="100" height="50" fill="white" rx="5" stroke="#6c757d" stroke-width="2"/>
      <text x="50" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#333">MySQL</text>
      <text x="50" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">(Optional)</text>
    </g>
  </g>

  <!-- External Systems Layer -->
  <g transform="translate(550, 520)">
    <rect x="0" y="0" width="550" height="100" fill="url(#soarGradient)" rx="10" filter="url(#dropshadow)"/>
    <text x="275" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">
      External Systems Layer
    </text>

    <g transform="translate(50, 35)">
      <rect x="0" y="0" width="200" height="50" fill="white" rx="5" stroke="#E91E63" stroke-width="2"/>
      <text x="100" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">OctoMation SOAR</text>
      <text x="100" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Security Orchestration Platform</text>
    </g>

    <g transform="translate(300, 35)">
      <rect x="0" y="0" width="180" height="50" fill="white" rx="5" stroke="#E91E63" stroke-width="2"/>
      <text x="90" y="20" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#333">Security Tools</text>
      <text x="90" y="35" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#666">Threat Detection & Response</text>
    </g>
  </g>

  <!-- Protocol Annotations -->
  <g transform="translate(50, 650)">
    <text x="0" y="20" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">Communication Protocols:</text>

    <g transform="translate(180, 0)">
      <line x1="0" y1="15" x2="30" y2="15" stroke="#2196F3" stroke-width="3"/>
      <text x="40" y="20" font-family="Arial, sans-serif" font-size="12" fill="#333">MCP Protocol (Model Context Protocol)</text>
    </g>

    <g transform="translate(450, 0)">
      <line x1="0" y1="15" x2="30" y2="15" stroke="#FF9800" stroke-width="3"/>
      <text x="40" y="20" font-family="Arial, sans-serif" font-size="12" fill="#333">HTTP/HTTPS REST API</text>
    </g>

    <g transform="translate(650, 0)">
      <line x1="0" y1="15" x2="30" y2="15" stroke="#E91E63" stroke-width="3"/>
      <text x="40" y="20" font-family="Arial, sans-serif" font-size="12" fill="#333">SOAR API Interface</text>
    </g>

    <g transform="translate(850, 0)">
      <line x1="0" y1="15" x2="30" y2="15" stroke="#6c757d" stroke-width="3"/>
      <text x="40" y="20" font-family="Arial, sans-serif" font-size="12" fill="#333">Database Connection</text>
    </g>
  </g>

  <!-- Core Features -->
  <g transform="translate(50, 690)">
    <text x="0" y="20" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">Core Features:</text>
    <text x="120" y="20" font-family="Arial, sans-serif" font-size="12" fill="#666">• Dual Server Architecture</text>
    <text x="280" y="20" font-family="Arial, sans-serif" font-size="12" fill="#666">• Async Processing</text>
    <text x="400" y="20" font-family="Arial, sans-serif" font-size="12" fill="#666">• Smart Sync</text>
    <text x="500" y="20" font-family="Arial, sans-serif" font-size="12" fill="#666">• Security Auth</text>
    <text x="600" y="20" font-family="Arial, sans-serif" font-size="12" fill="#666">• Multi-DB Support</text>
    <text x="730" y="20" font-family="Arial, sans-serif" font-size="12" fill="#666">• Standard MCP Protocol</text>
  </g>

  <!-- Port Information -->
  <g transform="translate(50, 720)">
    <text x="0" y="20" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#333">Service Ports:</text>
    <text x="120" y="20" font-family="Arial, sans-serif" font-size="12" fill="#2196F3">MCP Server: 12345</text>
    <text x="260" y="20" font-family="Arial, sans-serif" font-size="12" fill="#FF9800">Web Management: 12346</text>
    <text x="420" y="20" font-family="Arial, sans-serif" font-size="12" fill="#666">Access: http://127.0.0.1:12345/mcp?token=xxxx</text>
  </g>

  <!-- Define arrow marker -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7"
            refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>

  <!-- Data flow arrows -->
  <!-- MCP data flow -->
  <path d="M 175 190 Q 175 150 300 190" stroke="#2196F3" stroke-width="2" fill="none"
        stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <text x="220" y="160" font-family="Arial, sans-serif" font-size="10" fill="#2196F3">MCP Request</text>

  <!-- Sync data flow -->
  <path d="M 635 360 Q 700 340 635 520" stroke="#E91E63" stroke-width="2" fill="none"
        stroke-dasharray="5,5" marker-end="url(#arrowhead)"/>
  <text x="650" y="430" font-family="Arial, sans-serif" font-size="10" fill="#E91E63">Sync</text>

</svg>