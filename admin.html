<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOAR MCP Server ç®¡ç†åå°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body, html {
            height: 100%;
            font-family: 'Inter', 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
            color: #333;
            background: #f8fafc;
        }

        /* ç§»é™¤å…¨å±€header-backgroundç±»ï¼Œç°åœ¨ç›´æ¥åœ¨headerä¸Šä½¿ç”¨ä¼ªå…ƒç´  */

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        /* ç§»é™¤å…¨å±€æµ®åŠ¨è£…é¥°å…ƒç´ ï¼Œåªåœ¨headeråŒºåŸŸä¿ç•™ */
        
        .header {
            background: transparent;
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 10;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* Headeréœ€è¦èƒŒæ™¯å®¹å™¨ */
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg,
                #3b82f6 0%,
                #2563eb 15%,
                #1d4ed8 30%,
                #1e40af 45%,
                #0ea5e9 60%,
                #06b6d4 75%,
                #14b8a6 90%,
                #38bdf8 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            z-index: -1;
        }

        .header::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(56, 189, 248, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(20, 184, 166, 0.3) 0%, transparent 50%);
            z-index: -1;
        }

        .header h1 {
            color: #f8fffe;
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            margin: 0;
            text-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        
        .nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-left {
            display: flex;
            gap: 0.5rem;
        }

        .nav-right {
            display: flex;
            gap: 0.5rem;
        }
        
        .nav-item {
            display: inline-block;
            color: #e8f5f3;
            text-decoration: none;
            padding: 0.4rem 0.8rem;
            border-radius: 6px;
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(56, 189, 248, 0.2);
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 0.85rem;
            backdrop-filter: blur(10px);
        }

        .nav-item.active, .nav-item:hover {
            background: rgba(59, 130, 246, 0.25);
            color: #f0fdfa;
            border-color: rgba(56, 189, 248, 0.4);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
            transform: translateY(-1px);
        }

        .nav-item.logout {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(248, 113, 113, 0.3);
            color: #fef2f2;
        }

        .nav-item.logout:hover {
            background: rgba(239, 68, 68, 0.25);
            color: #fef2f2;
            border-color: rgba(248, 113, 113, 0.5);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
        }
        
        .container {
            max-width: 95%;
            margin: 2rem auto;
            padding: 0 2rem;
            background: #f8fafc;
            min-height: calc(100vh - 200px);
        }
        
        .card {
            background: #ffffff;
            border-radius: 20px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            margin-bottom: 2rem;
            position: relative;
            color: #334155;
        }

        @keyframes cardFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #3b82f6, #2563eb, #0ea5e9, #14b8a6, #38bdf8);
            border-radius: 20px 20px 0 0;
            z-index: 1;
        }

        @keyframes borderGlow {
            0% { opacity: 0.2; }
            100% { opacity: 0.5; }
        }
        
        .card-header {
            background: #f8fafc;
            padding: 1.5rem 2rem;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }
        
        .stats {
            display: flex;
            gap: 1rem;
        }
        
        .stat-item {
            background: linear-gradient(135deg, #14b8a6, #0ea5e9);
            color: #eff6ff;
            padding: 0.6rem 1.2rem;
            border-radius: 10px;
            min-width: fit-content;
            white-space: nowrap;
            font-size: 0.875rem;
            font-weight: 600;
            border: 1px solid rgba(52, 211, 153, 0.3);
            box-shadow: 0 2px 8px rgba(20, 184, 166, 0.2);
            backdrop-filter: blur(5px);
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .table th {
            background: #e0f2fe;
            color: #0369a1;
            font-weight: 600;
            padding: 1rem 1.5rem;
            text-align: left;
            border-bottom: 2px solid #0ea5e9;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .table td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e2e8f0;
            vertical-align: middle;
            color: #1e293b;
            font-size: 0.9rem;
        }
        
        .table tbody tr:hover {
            background: #f1f5f9;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 28px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #e2e8f0, #cbd5e0);
            transition: all 0.3s ease;
            border-radius: 28px;
            border: 1px solid rgba(203, 213, 224, 0.5);
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background: linear-gradient(135deg, #ffffff, #f7fafc);
            transition: all 0.3s ease;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        input:checked + .slider {
            background: linear-gradient(135deg, #14b8a6, #0ea5e9);
            border-color: rgba(20, 184, 166, 0.5);
            box-shadow: 0 0 0 2px rgba(20, 184, 166, 0.2),
                        inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        input:checked + .slider:before {
            transform: translateX(22px);
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
        }
        
        .category-badge {
            display: inline-block;
            background: #e2e8f0;
            color: #4a5568;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .playbook-id {
            font-family: 'Monaco', 'Menlo', monospace;
            color: #805ad5;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .playbook-id:hover {
            color: #553c9a;
            text-decoration: underline;
        }
        
        .playbook-display-name {
            color: #2d3748;
            font-weight: 500;
            font-size: 0.95rem;
        }
        
        .loading {
            text-align: center;
            padding: 3rem;
            color: #718096;
        }
        
        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .success {
            background: #c6f6d5;
            color: #2f855a;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        /* Modal æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
        }
        
        .modal-content {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin: 5% auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15),
                        inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }
        
        .modal-header {
            background: linear-gradient(135deg, #14b8a6 0%, #0ea5e9 100%);
            color: white;
            padding: 1.5rem 2rem;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }
        
        .close {
            color: rgba(255, 255, 255, 0.8);
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            line-height: 1;
            transition: color 0.2s ease;
        }
        
        .close:hover {
            color: white;
        }
        
        .modal-body {
            padding: 2rem;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 0 0 12px 12px;
        }
        
        .detail-section {
            margin-bottom: 2rem;
        }
        
        .detail-section:last-child {
            margin-bottom: 0;
        }
        
        .detail-label {
            font-weight: 600;
            color: #0ea5e9;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }
        
        .detail-value {
            color: #1f2937;
            font-size: 0.95rem;
            line-height: 1.5;
            font-weight: 500;
        }
        
        .param-item {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .param-item:last-child {
            margin-bottom: 0;
        }
        
        .param-name {
            font-weight: 600;
            color: #805ad5;
            margin-bottom: 0.5rem;
        }
        
        .param-type {
            display: inline-block;
            background: #4c51bf;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-right: 0.5rem;
        }
        
        .param-required {
            color: #e53e3e;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .param-description {
            color: #718096;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }

        /* åº•éƒ¨ä¿¡æ¯æ ·å¼ */
        .footer {
            margin-top: 3rem;
            padding: 2rem 0;
            text-align: center;
            background: transparent;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        /* Footerè“è‰²èƒŒæ™¯ */
        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg,
                #3b82f6 0%,
                #2563eb 15%,
                #1d4ed8 30%,
                #1e40af 45%,
                #0ea5e9 60%,
                #06b6d4 75%,
                #14b8a6 90%,
                #38bdf8 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            z-index: -1;
        }

        .footer::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 20% 80%, rgba(56, 189, 248, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 60% 60%, rgba(20, 184, 166, 0.3) 0%, transparent 50%);
            z-index: -1;
        }

        .footer-content {
            color: #ffffff;
            font-size: 0.85rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.7);
            position: relative;
            z-index: 1001;
            font-weight: 500;
        }

        .footer-content a {
            color: #38bdf8;
            text-decoration: none;
            font-weight: 600;
            margin: 0 0.5rem;
            transition: all 0.3s ease;
            position: relative;
            z-index: 1002;
            cursor: pointer;
        }

        .footer-content a:hover {
            color: #14b8a6;
            text-shadow: 0 0 8px rgba(56, 189, 248, 0.6);
        }

        @media (max-width: 768px) {
            .container {
                padding: 0 1rem;
                max-width: 100%;
            }
            
            .header {
                padding: 1rem;
            }
            
            .card-header {
                padding: 1rem;
            }
            
            .table th,
            .table td {
                padding: 0.75rem 0.5rem;
            }
            
            .stats {
                flex-wrap: wrap;
            }
            
            .modal-content {
                width: 95%;
                margin: 2% auto;
            }
            
            .modal-header {
                padding: 1rem;
            }
            
            .modal-body {
                padding: 1rem;
            }
        }
        
        /* åˆ†é¡µæ§ä»¶æ ·å¼ */
        .pagination-container {
            margin: 1rem 0 0 0;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 0.75rem;
            background: transparent;
            gap: 1rem;
        }
        
        .pagination-info {
            font-size: 0.9rem;
            color: #64748b;
        }
        
        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .pagination-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #d1d5db;
            background: #ffffff;
            color: #374151;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .pagination-btn:hover:not(:disabled) {
            background: #f3f4f6;
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .pagination-btn:disabled {
            background: #f9fafb;
            color: #9ca3af;
            cursor: not-allowed;
            border-color: #e5e7eb;
        }
        
        .page-numbers {
            display: flex;
            gap: 0.25rem;
        }
        
        .page-number {
            padding: 0.5rem 0.75rem;
            border: 1px solid #ddd;
            background: white;
            color: #333;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
            min-width: 36px;
            text-align: center;
        }
        
        .page-number:hover {
            background: #f8f9fa;
            border-color: #007bff;
            color: #007bff;
        }
        
        .page-number.active {
            background: #007bff;
            border-color: #007bff;
            color: white;
        }
        
        .page-number.ellipsis {
            cursor: default;
            border: none;
            background: transparent;
        }
        
        .page-number.ellipsis:hover {
            background: transparent;
            color: #333;
        }
        
        /* ç³»ç»Ÿé…ç½®æ ·å¼ */
        .config-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #14b8a6, #0ea5e9);
            color: #eff6ff;
            border: 1px solid rgba(52, 211, 153, 0.3);
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.25);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #0ea5e9, #1d4ed8);
            box-shadow: 0 6px 20px rgba(20, 184, 166, 0.35);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: rgba(59, 130, 246, 0.15);
            color: #1e40af;
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.1);
        }

        .btn-secondary:hover {
            background: rgba(59, 130, 246, 0.25);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
            transform: translateY(-1px);
        }
        
        .config-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            padding: 2rem;
        }
        
        .config-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group .label-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
        }

        .form-group label {
            font-weight: 600;
            color: #333;
            margin: 0;
        }

        .form-group .form-help {
            font-size: 0.85em;
            color: #666;
            margin: 0;
            font-style: italic;
        }

        /* åŒæ­¥å‘¨æœŸé€‰æ‹©æ¡†æ ·å¼ */
        #sync-interval {
            max-width: 150px;
        }
        
        .form-input {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.9rem;
            transition: border-color 0.2s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
        }
        
        .form-help {
            font-size: 0.8rem;
            color: #666;
        }
        
        .password-input-container {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .password-input-container .form-input {
            padding-right: 3rem;
            width: 100%;
            min-width: 400px;
        }
        
        .password-toggle {
            position: absolute;
            right: 0.75rem;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
            font-size: 1rem;
            color: #666;
            z-index: 1;
        }
        
        .password-toggle:hover {
            color: #333;
        }
        
        .status-success {
            color: #28a745;
            font-weight: bold;
        }
        
        .status-error {
            color: #dc3545;
            font-weight: bold;
        }
        
        .status-warning {
            color: #ffc107;
            font-weight: bold;
        }
        
        /* é™åˆ¶ç‰¹å®šè¾“å…¥æ¡†çš„å®½åº¦ */
        #soar-timeout {
            max-width: 120px;
        }
        
        .labels-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .labels-input {
            display: flex;
            gap: 0.5rem;
        }
        
        .labels-input .form-input {
            flex: 1;
        }
        
        .labels-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            min-height: 2rem;
        }
        
        .label-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: #e3f2fd;
            color: #1976d2;
            border-radius: 16px;
            font-size: 0.8rem;
            border: 1px solid #bbdefb;
        }
        
        .label-tag .remove-label {
            background: none;
            border: none;
            color: #1976d2;
            cursor: pointer;
            font-size: 1rem;
            line-height: 1;
            padding: 0;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .label-tag .remove-label:hover {
            background: #1976d2;
            color: white;
            border-radius: 50%;
        }
        
        .config-status {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .config-status h3 {
            margin-bottom: 1rem;
            color: #495057;
            font-size: 1.1rem;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            font-weight: 600;
            color: #495057;
        }
        
        .status-value {
            color: #6c757d;
        }
        
        .status-success {
            color: #28a745 !important;
        }
        
        .status-error {
            color: #dc3545 !important;
        }
        
        .status-warning {
            color: #ffc107 !important;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
            padding: 0 1rem;
        }

        .stat-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05),
                        0 2px 8px rgba(0, 0, 0, 0.03);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #14b8a6, #0ea5e9, #38bdf8);
            opacity: 0.8;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1),
                        0 4px 16px rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
        }
        
        .stat-card h3 {
            margin: 0 0 1.5rem 0;
            color: #1e293b;
            font-size: 1.2rem;
            font-weight: 700;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 0.75rem;
        }
        
        .stats-grid .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 10px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
        }

        .stats-grid .stat-item:hover {
            background: #eff6ff;
            border-color: #3b82f6;
            transform: translateX(2px);
        }

        .stats-grid .stat-item:last-child {
            margin-bottom: 0;
        }

        .stat-label {
            font-weight: 500;
            color: #475569;
        }

        .stat-value {
            font-weight: 700;
            color: #1e293b;
        }
        
        @media (max-width: 768px) {
            .config-container {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .labels-input {
                flex-direction: column;
            }
            
            .config-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <!-- åŠ¨æ€èƒŒæ™¯ -->
    <div class="background"></div>

    <!-- æµ®åŠ¨è£…é¥°å…ƒç´  -->
    <div class="floating-elements">
        <div class="floating-shape shape-1"></div>
        <div class="floating-shape shape-2"></div>
        <div class="floating-shape shape-3"></div>
    </div>

    <div class="header">
        <h1 style="display: flex; align-items: center; gap: 12px;">
            <img src="/static/logo.webp"
                 alt="SOAR MCP Server Logo"
                 style="width: 48px; height: 48px; border-radius: 8px; object-fit: cover;">
            SOAR MCP Server ç®¡ç†åå°
        </h1>
        <nav class="nav">
            <div class="nav-left">
                <a href="#" class="nav-item active" id="nav-playbooks">å‰§æœ¬ç®¡ç†</a>
                <a href="#" class="nav-item" id="nav-tokens">Tokenç®¡ç†</a>
                <a href="#" class="nav-item" id="nav-config">ç³»ç»Ÿé…ç½®</a>
                <a href="#" class="nav-item" id="nav-stats">ç»Ÿè®¡ä¿¡æ¯</a>
            </div>
            <div class="nav-right">
                <a href="#" class="nav-item logout" id="logout-btn">æ³¨é”€</a>
            </div>
        </nav>
    </div>
    
    <div class="container">
        <div id="alert-container"></div>
        
        <!-- å‰§æœ¬è¯¦æƒ… Modal -->
        <div id="playbook-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">å‰§æœ¬è¯¦æƒ…</h3>
                    <button class="close" id="close-modal-btn">&times;</button>
                </div>
                <div class="modal-body" id="modal-body">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
        
        <div class="card" id="playbooks-section">
            <div class="card-header">
                <h2 class="card-title">å‰§æœ¬ç®¡ç†</h2>
                <div class="stats" id="playbook-stats">
                    <div class="stat-item">æ€»è®¡: <span id="total-count">-</span></div>
                    <div class="stat-item">å¯ç”¨: <span id="enabled-count">-</span></div>
                    <div class="stat-item">ç¦ç”¨: <span id="disabled-count">-</span></div>
                </div>
            </div>
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th width="25%">å‰§æœ¬ID</th>
                            <th width="50%">æ˜¾ç¤ºåç§°</th>
                            <th width="15%">æœ€ååŒæ­¥</th>
                            <th width="10%">çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="playbooks-tbody">
                        <tr>
                            <td colspan="4" class="loading">
                                <div>æ­£åœ¨åŠ è½½å‰§æœ¬æ•°æ®...</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- åˆ†é¡µæ§ä»¶ -->
            <div class="pagination-container">
                <div class="pagination-info">
                    <span id="pagination-info">æ˜¾ç¤ºç¬¬ 1-20 æ¡ï¼Œå…± 0 æ¡</span>
                </div>
                <div class="pagination-controls">
                    <button id="prev-page" class="pagination-btn" disabled>ä¸Šä¸€é¡µ</button>
                    <div id="page-numbers" class="page-numbers"></div>
                    <button id="next-page" class="pagination-btn" disabled>ä¸‹ä¸€é¡µ</button>
                </div>
            </div>
        </div>

        <!-- Tokenç®¡ç†åŒºåŸŸ -->
        <div class="card" id="tokens-section" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">Tokenç®¡ç†</h2>
                <div class="config-actions">
                    <button id="create-token-btn" class="btn btn-primary" onclick="showCreateTokenModal()">åˆ›å»ºToken</button>
                </div>
            </div>
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th width="18%">Tokenåç§°</th>
                            <th width="20%">Tokenå€¼</th>
                            <th width="14%">åˆ›å»ºæ—¶é—´</th>
                            <th width="14%">è¿‡æœŸæ—¶é—´</th>
                            <th width="16%">æœ€åä½¿ç”¨</th>
                            <th width="10%">çŠ¶æ€</th>
                            <th width="8%">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="tokens-tbody">
                        <tr>
                            <td colspan="7" class="loading">
                                <div>æ­£åœ¨åŠ è½½Tokenæ•°æ®...</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- åˆ›å»ºToken Modal -->
        <div id="create-token-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">åˆ›å»ºæ–°Token</h3>
                    <button class="close" onclick="closeCreateTokenModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="token-name">Tokenåç§°</label>
                        <input type="text" id="token-name" class="form-input" placeholder="è¾“å…¥Tokenæè¿°åç§°" required>
                        <small class="form-help">ç”¨äºæ ‡è¯†æ­¤Tokençš„æè¿°æ€§åç§°</small>
                    </div>

                    <div class="form-group">
                        <label for="token-expires">è¿‡æœŸæ—¶é—´</label>
                        <select id="token-expires" class="form-input">
                            <option value="">æ°¸ä¸è¿‡æœŸ</option>
                            <option value="7">7å¤©åè¿‡æœŸ</option>
                            <option value="30">30å¤©åè¿‡æœŸ</option>
                            <option value="90">90å¤©åè¿‡æœŸ</option>
                        </select>
                        <small class="form-help">Tokençš„æœ‰æ•ˆæœŸï¼Œè¿‡æœŸåå°†è‡ªåŠ¨å¤±æ•ˆ</small>
                    </div>

                    <div class="config-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeCreateTokenModal()">å–æ¶ˆ</button>
                        <button type="button" class="btn btn-primary" onclick="createToken()">åˆ›å»ºToken</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ˜¾ç¤ºTokenå€¼ Modal -->
        <div id="show-token-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Tokenåˆ›å»ºæˆåŠŸ</h3>
                    <button class="close" onclick="closeShowTokenModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
                        <div style="color: #dc2626; font-weight: 600; font-size: 0.9rem;">
                            âš ï¸ é‡è¦æç¤ºï¼šè¯·ç«‹å³å¤åˆ¶å¹¶ä¿å­˜ä»¥ä¸‹ä¿¡æ¯ï¼Œå…³é—­çª—å£åå°†æ— æ³•å†æ¬¡æŸ¥çœ‹å®Œæ•´Tokenï¼
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Tokenå€¼</label>
                        <div class="password-input-container">
                            <input type="text" id="new-token-value" class="form-input" readonly>
                            <button type="button" class="password-toggle" onclick="copyTokenToClipboard()">
                                <span>ğŸ“‹</span>
                            </button>
                        </div>
                        <small class="form-help">
                            ç”¨äºAPIè®¤è¯çš„è®¿é—®ä»¤ç‰Œ
                        </small>
                    </div>

                    <div class="form-group">
                        <label>å®Œæ•´MCP URL (Streamable HTTP)</label>
                        <div class="password-input-container">
                            <input type="text" id="new-mcp-url" class="form-input" readonly>
                            <button type="button" class="password-toggle" onclick="copyMcpUrlToClipboard()">
                                <span>ğŸ“‹</span>
                            </button>
                        </div>
                        <small class="form-help">
                            Streamable HTTPç±»å‹çš„MCPæœåŠ¡å™¨URLï¼Œå¯ç›´æ¥ç”¨äºClaude Desktopã€Cherry Studioç­‰MCPå®¢æˆ·ç«¯é…ç½®
                        </small>
                    </div>

                    <div class="config-actions">
                        <button type="button" class="btn btn-primary" onclick="copyTokenToClipboard()">å¤åˆ¶Token</button>
                        <button type="button" class="btn btn-primary" onclick="copyMcpUrlToClipboard()">å¤åˆ¶MCP URL</button>
                        <button type="button" class="btn btn-secondary" onclick="closeShowTokenModal()">å…³é—­</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç³»ç»Ÿé…ç½®åŒºåŸŸ -->
        <div class="card" id="config-section" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">ç³»ç»Ÿé…ç½®</h2>
                <div class="config-actions">
                    <button id="test-connection-btn" class="btn btn-primary" onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
                    <button id="save-config-btn" class="btn btn-primary" onclick="saveConfiguration()">ä¿å­˜é…ç½®</button>
                </div>
            </div>
            
            <div class="config-container">
                <div class="config-form">
                    <div class="form-group">
                        <div class="label-row">
                            <label for="soar-api-url">SOARæœåŠ¡å™¨APIåœ°å€</label>
                            <small class="form-help">SOARæœåŠ¡å™¨çš„APIåŸºç¡€åœ°å€</small>
                        </div>
                        <input type="url" id="soar-api-url" class="form-input" placeholder="https://hg.wuzhi-ai.com" required>
                    </div>
                    
                    <div class="form-group">
                        <div class="label-row">
                            <label for="soar-api-token">API Token</label>
                            <small class="form-help">ç”¨äºAPIè®¤è¯çš„Token</small>
                        </div>
                        <div class="password-input-container">
                            <input type="password" id="soar-api-token" class="form-input" placeholder="è¾“å…¥API Token" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('soar-api-token')">
                                <span class="eye-icon" id="soar-api-token-eye">ğŸ‘ï¸</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="label-row">
                            <label for="soar-timeout">è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰</label>
                            <small class="form-help">APIè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œå»ºè®®30-60ç§’</small>
                        </div>
                        <input type="number" id="soar-timeout" class="form-input" min="1" max="300" value="30" required>
                    </div>

                    <div class="form-group">
                        <div class="label-row">
                            <label for="sync-interval">åŒæ­¥å‘¨æœŸ</label>
                            <small class="form-help">å‰§æœ¬å’Œåº”ç”¨çš„è‡ªåŠ¨åŒæ­¥å‘¨æœŸï¼Œé»˜è®¤4å°æ—¶</small>
                        </div>
                        <select id="sync-interval" class="form-input" required>
                            <option value="3600">1å°æ—¶</option>
                            <option value="14400" selected>4å°æ—¶</option>
                            <option value="43200">12å°æ—¶</option>
                            <option value="86400">24å°æ—¶</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <div class="label-row">
                            <label for="label-input">å‰§æœ¬æŠ“å–æ ‡ç­¾</label>
                            <small class="form-help">ç”¨äºè¿‡æ»¤åŒæ­¥çš„å‰§æœ¬æ ‡ç­¾ï¼Œè‡³å°‘éœ€è¦ä¸€ä¸ªæ ‡ç­¾</small>
                        </div>
                        <div class="labels-container">
                            <div class="labels-input">
                                <input type="text" id="label-input" class="form-input" placeholder="è¾“å…¥æ ‡ç­¾åç§°" maxlength="50">
                                <button type="button" id="add-label-btn" class="btn btn-primary" onclick="addLabel()">æ·»åŠ </button>
                            </div>
                            <div class="labels-list" id="labels-list">
                                <!-- æ ‡ç­¾åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="config-status" id="config-status">
                    <h3>é…ç½®çŠ¶æ€</h3>
                    <div class="status-item">
                        <span class="status-label">é…ç½®éªŒè¯:</span>
                        <span class="status-value" id="config-valid">æœªéªŒè¯</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">è¿æ¥æµ‹è¯•:</span>
                        <span class="status-value" id="connection-status">æœªæµ‹è¯•</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">æœ€åæ›´æ–°:</span>
                        <span class="status-value" id="config-updated">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ç»Ÿè®¡ä¿¡æ¯é¡µé¢ -->
        <div class="card" id="stats-section" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">ç»Ÿè®¡ä¿¡æ¯</h2>
                <div class="card-actions">
                    <button class="btn btn-primary" onclick="refreshStats()">åˆ·æ–°ç»Ÿè®¡</button>
                </div>
            </div>
            <div class="card-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>å‰§æœ¬ç»Ÿè®¡</h3>
                        <div class="stat-item">
                            <span class="stat-label">æ€»å‰§æœ¬æ•°ï¼š</span>
                            <span class="stat-value" id="total-playbooks">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">å·²å¯ç”¨ï¼š</span>
                            <span class="stat-value" id="enabled-playbooks">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">å·²ç¦ç”¨ï¼š</span>
                            <span class="stat-value" id="disabled-playbooks">-</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <h3>åº”ç”¨ç»Ÿè®¡</h3>
                        <div class="stat-item">
                            <span class="stat-label">æ€»åº”ç”¨æ•°ï¼š</span>
                            <span class="stat-value" id="total-apps">-</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <h3>ç³»ç»ŸçŠ¶æ€</h3>
                        <div class="stat-item">
                            <span class="stat-label">æœåŠ¡çŠ¶æ€ï¼š</span>
                            <span class="stat-value status-success" id="service-status">è¿è¡Œä¸­</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">æœ€ååŒæ­¥ï¼š</span>
                            <span class="stat-value" id="last-sync">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥è®¤è¯çŠ¶æ€
        function checkAuth() {
            const jwt = localStorage.getItem('jwt_token');
            if (!jwt) {
                // å¦‚æœæ²¡æœ‰tokenï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
                window.location.href = '/login';
                return false;
            }
            return jwt;
        }

        // æ³¨é”€å‡½æ•°
        function logout() {
            // ç¡®è®¤æ³¨é”€
            if (confirm('ç¡®å®šè¦æ³¨é”€å—ï¼Ÿ')) {
                // æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„JWT token
                localStorage.removeItem('jwt_token');
                // è·³è½¬åˆ°ç™»å½•é¡µé¢
                window.location.href = '/login';
            }
        }

        // é€šç”¨APIè°ƒç”¨å‡½æ•°ï¼Œè‡ªåŠ¨æ·»åŠ JWTè®¤è¯å¤´
        async function apiCall(url, options = {}) {
            const jwt = checkAuth();
            if (!jwt) return null;

            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${jwt}`
                }
            };

            const mergedOptions = {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...(options.headers || {})
                }
            };

            try {
                const response = await fetch(url, mergedOptions);

                // å¦‚æœè¿”å›401ï¼Œæ¸…é™¤tokenå¹¶è·³è½¬åˆ°ç™»å½•é¡µ
                if (response.status === 401) {
                    localStorage.removeItem('jwt_token');
                    window.location.href = '/login';
                    return null;
                }

                return response;
            } catch (error) {
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                throw error;
            }
        }

        // å…¨å±€çŠ¶æ€
        let playbooks = [];
        let currentPage = 1;
        const itemsPerPage = 20;
        
        // DOM å…ƒç´ 
        const alertContainer = document.getElementById('alert-container');
        const playbooksTable = document.getElementById('playbooks-tbody');
        const totalCount = document.getElementById('total-count');
        const enabledCount = document.getElementById('enabled-count');
        const disabledCount = document.getElementById('disabled-count');
        const paginationInfo = document.getElementById('pagination-info');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const pageNumbers = document.getElementById('page-numbers');
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showAlert(message, type = 'success') {
            const alert = document.createElement('div');
            alert.className = type === 'error' ? 'error' : 'success';
            alert.textContent = message;
            alertContainer.innerHTML = '';
            alertContainer.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // æ˜¾ç¤ºå¢å¼ºçš„å¤åˆ¶æˆåŠŸæé†’
        function showCopySuccessAlert(message) {
            // åˆ›å»ºç‰¹æ®Šçš„å¤åˆ¶æˆåŠŸæé†’æ¡†
            const copyAlert = document.createElement('div');
            copyAlert.className = 'copy-success-alert';
            copyAlert.innerHTML = `
                <div class="copy-success-content">
                    <span class="copy-success-icon">âœ…</span>
                    <span class="copy-success-text">${message}</span>
                </div>
            `;

            // æ·»åŠ æ ·å¼
            copyAlert.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                color: white;
                padding: 1.5rem 2rem;
                border-radius: 16px;
                box-shadow: 0 20px 40px rgba(16, 185, 129, 0.4),
                           0 8px 16px rgba(0, 0, 0, 0.2);
                z-index: 10000;
                border: 1px solid rgba(255, 255, 255, 0.2);
                backdrop-filter: blur(10px);
                animation: copySuccessAnimation 0.6s ease-out;
                min-width: 300px;
                text-align: center;
            `;

            // æ·»åŠ åŠ¨ç”»æ ·å¼
            if (!document.getElementById('copy-success-style')) {
                const style = document.createElement('style');
                style.id = 'copy-success-style';
                style.textContent = `
                    @keyframes copySuccessAnimation {
                        0% {
                            opacity: 0;
                            transform: translate(-50%, -50%) scale(0.8);
                        }
                        50% {
                            opacity: 1;
                            transform: translate(-50%, -50%) scale(1.05);
                        }
                        100% {
                            opacity: 1;
                            transform: translate(-50%, -50%) scale(1);
                        }
                    }
                    .copy-success-content {
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 0.75rem;
                    }
                    .copy-success-icon {
                        font-size: 1.5rem;
                    }
                    .copy-success-text {
                        font-size: 1rem;
                        font-weight: 600;
                        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
                    }
                `;
                document.head.appendChild(style);
            }

            // æ·»åŠ åˆ°é¡µé¢å¹¶è‡ªåŠ¨ç§»é™¤
            document.body.appendChild(copyAlert);

            setTimeout(() => {
                copyAlert.style.animation = 'copySuccessAnimation 0.3s ease-out reverse';
                setTimeout(() => {
                    if (copyAlert.parentNode) {
                        copyAlert.remove();
                    }
                }, 300);
            }, 2000);
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            try {
                const date = new Date(dateStr);
                return date.toLocaleString('zh-CN');
            } catch {
                return '-';
            }
        }
        
        // åˆ‡æ¢å‰§æœ¬çŠ¶æ€
        async function togglePlaybook(playbookId, enabled) {
            try {
                const response = await apiCall(`/api/admin/playbooks/${playbookId}/toggle`, {
                    method: 'POST',
                    body: JSON.stringify({ enabled: enabled })
                });

                if (!response) return;
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert(`å‰§æœ¬ ${playbookId} å·²${enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'success');
                    // æ›´æ–°æœ¬åœ°çŠ¶æ€ (æ³¨æ„ï¼šæ¯”è¾ƒæ—¶ç»Ÿä¸€è½¬æ¢ä¸ºå­—ç¬¦ä¸²)
                    const playbook = playbooks.find(p => String(p.id) === String(playbookId));
                    if (playbook) {
                        playbook.enabled = enabled;
                        updateStats();
                    }
                } else {
                    showAlert(result.error || 'æ“ä½œå¤±è´¥', 'error');
                    // å›æ»šå¼€å…³çŠ¶æ€
                    const toggle = document.querySelector(`input[data-id="${playbookId}"]`);
                    if (toggle) {
                        toggle.checked = !enabled;
                    }
                }
            } catch (error) {
                showAlert('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                // å›æ»šå¼€å…³çŠ¶æ€
                const toggle = document.querySelector(`input[data-id="${playbookId}"]`);
                if (toggle) {
                    toggle.checked = !enabled;
                }
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const total = playbooks.length;
            const enabled = playbooks.filter(p => p.enabled).length;
            const disabled = total - enabled;
            
            totalCount.textContent = total;
            enabledCount.textContent = enabled;
            disabledCount.textContent = disabled;
        }
        
        // æ¸²æŸ“å‰§æœ¬è¡¨æ ¼
        function renderPlaybooks() {
            if (playbooks.length === 0) {
                playbooksTable.innerHTML = `
                    <tr>
                        <td colspan="4" class="loading">
                            <div>æš‚æ— å‰§æœ¬æ•°æ®</div>
                        </td>
                    </tr>
                `;
                updatePagination();
                return;
            }
            
            // è®¡ç®—åˆ†é¡µæ•°æ®
            const totalPages = Math.ceil(playbooks.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentPlaybooks = playbooks.slice(startIndex, endIndex);
            
            playbooksTable.innerHTML = currentPlaybooks.map(playbook => `
                <tr>
                    <td>
                        <span class="playbook-id" data-id="${playbook.id}">${String(playbook.id)}</span>
                    </td>
                    <td>
                        <div class="playbook-display-name">${playbook.displayName || playbook.name}</div>
                    </td>
                    <td>${formatDate(playbook.syncTime)}</td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" data-id="${playbook.id}" ${playbook.enabled ? 'checked' : ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                </tr>
            `).join('');
            
            // ç»‘å®šå¼€å…³äº‹ä»¶
            playbooksTable.querySelectorAll('input[type="checkbox"]').forEach(toggle => {
                toggle.addEventListener('change', (e) => {
                    const playbookId = e.target.dataset.id; // ä¿æŒå­—ç¬¦ä¸²æ ¼å¼é¿å…ç²¾åº¦ä¸¢å¤±
                    const enabled = e.target.checked;
                    togglePlaybook(playbookId, enabled);
                });
            });
            
            // ç»‘å®šå‰§æœ¬IDç‚¹å‡»äº‹ä»¶
            playbooksTable.querySelectorAll('.playbook-id').forEach(playbookIdElement => {
                playbookIdElement.addEventListener('click', (e) => {
                    const playbookId = e.target.dataset.id; // ä¿æŒå­—ç¬¦ä¸²æ ¼å¼é¿å…ç²¾åº¦ä¸¢å¤±
                    showPlaybookDetail(playbookId);
                });
            });
            
            updateStats();
            updatePagination();
        }
        
        // åŠ è½½å‰§æœ¬æ•°æ®
        async function loadPlaybooks() {
            try {
                const response = await apiCall('/api/admin/playbooks');
                if (!response) return;

                const result = await response.json();
                
                if (result.success) {
                    playbooks = result.data;
                    renderPlaybooks();
                } else {
                    showAlert(result.error || 'åŠ è½½å‰§æœ¬æ•°æ®å¤±è´¥', 'error');
                    playbooksTable.innerHTML = `
                        <tr>
                            <td colspan="4" class="loading">
                                <div>åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                showAlert('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                playbooksTable.innerHTML = `
                    <tr>
                        <td colspan="4" class="loading">
                            <div>ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥</div>
                        </td>
                    </tr>
                `;
            }
        }
        
        // æ˜¾ç¤ºå‰§æœ¬è¯¦æƒ…
        async function showPlaybookDetail(playbookId) {
            const modal = document.getElementById('playbook-modal');
            const modalBody = document.getElementById('modal-body');
            
            modal.style.display = 'block';
            modalBody.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            
            try {
                const response = await apiCall(`/api/admin/playbooks/${playbookId}`);
                if (!response) {
                    modal.style.display = 'none';
                    return;
                }

                const result = await response.json();
                
                if (result.success) {
                    const playbook = result.data;
                    let params = [];
                    
                    // è§£æå‚æ•°
                    if (playbook.playbookParams) {
                        try {
                            params = JSON.parse(playbook.playbookParams);
                        } catch (e) {
                            console.warn('å‚æ•°è§£æå¤±è´¥:', e);
                        }
                    }
                    
                    modalBody.innerHTML = `
                        <div class="detail-section">
                            <div class="detail-label">å‰§æœ¬ID</div>
                            <div class="detail-value">${String(playbook.id)}</div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">å‰§æœ¬åç§°</div>
                            <div class="detail-value">${playbook.name}</div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">æ˜¾ç¤ºåç§°</div>
                            <div class="detail-value">${playbook.displayName || playbook.name}</div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">åˆ†ç±»</div>
                            <div class="detail-value">${playbook.playbookCategory}</div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">æè¿°</div>
                            <div class="detail-value">${playbook.description || 'æ— æè¿°'}</div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">åˆ›å»ºæ—¶é—´</div>
                            <div class="detail-value">${formatDate(playbook.createTime)}</div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">æ›´æ–°æ—¶é—´</div>
                            <div class="detail-value">${formatDate(playbook.updateTime)}</div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">æœ€ååŒæ­¥</div>
                            <div class="detail-value">${formatDate(playbook.syncTime)}</div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">çŠ¶æ€</div>
                            <div class="detail-value">${playbook.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨'}</div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">å‚æ•°ä¿¡æ¯ (${params.length} ä¸ª)</div>
                            <div class="detail-value">
                                ${params.length === 0 ? 'æ— å‚æ•°' : params.map(param => `
                                    <div class="param-item">
                                        <div class="param-name">
                                            ${param.cefColumn || param.key || 'æœªçŸ¥å‚æ•°'}
                                            <span class="param-type">${param.valueType || param.type || 'string'}</span>
                                            ${param.required ? '<span class="param-required">å¿…å¡«</span>' : ''}
                                        </div>
                                        ${param.cefDesc ? `<div class="param-description">${param.cefDesc}</div>` : ''}
                                        ${param.description ? `<div class="param-description">${param.description}</div>` : ''}
                                        ${param.defaultValue ? `<div class="param-description">é»˜è®¤å€¼: ${param.defaultValue}</div>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    modalBody.innerHTML = `<div class="error">åŠ è½½å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                modalBody.innerHTML = `<div class="error">ç½‘ç»œé”™è¯¯: ${error.message}</div>`;
            }
        }
        
        // å…³é—­Modal
        function closeModal() {
            document.getElementById('playbook-modal').style.display = 'none';
        }
        
        // æ›´æ–°åˆ†é¡µä¿¡æ¯å’Œæ§ä»¶
        function updatePagination() {
            const totalPages = Math.ceil(playbooks.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, playbooks.length);
            
            // æ›´æ–°åˆ†é¡µä¿¡æ¯
            if (playbooks.length === 0) {
                paginationInfo.textContent = 'æ˜¾ç¤ºç¬¬ 0-0 æ¡ï¼Œå…± 0 æ¡';
            } else {
                paginationInfo.textContent = `æ˜¾ç¤ºç¬¬ ${startIndex + 1}-${endIndex} æ¡ï¼Œå…± ${playbooks.length} æ¡`;
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
            
            // ç”Ÿæˆé¡µç 
            renderPageNumbers(totalPages);
        }
        
        // æ¸²æŸ“é¡µç 
        function renderPageNumbers(totalPages) {
            pageNumbers.innerHTML = '';
            
            if (totalPages <= 1) {
                return;
            }
            
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            // æ˜¾ç¤ºç¬¬ä¸€é¡µå’Œçœç•¥å·
            if (startPage > 1) {
                pageNumbers.appendChild(createPageButton(1));
                if (startPage > 2) {
                    pageNumbers.appendChild(createEllipsis());
                }
            }
            
            // æ˜¾ç¤ºé¡µç 
            for (let page = startPage; page <= endPage; page++) {
                pageNumbers.appendChild(createPageButton(page));
            }
            
            // æ˜¾ç¤ºçœç•¥å·å’Œæœ€åä¸€é¡µ
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pageNumbers.appendChild(createEllipsis());
                }
                pageNumbers.appendChild(createPageButton(totalPages));
            }
        }
        
        // åˆ›å»ºé¡µç æŒ‰é’®
        function createPageButton(page) {
            const button = document.createElement('div');
            button.className = `page-number ${page === currentPage ? 'active' : ''}`;
            button.textContent = page;
            button.onclick = () => goToPage(page);
            return button;
        }
        
        // åˆ›å»ºçœç•¥å·
        function createEllipsis() {
            const ellipsis = document.createElement('div');
            ellipsis.className = 'page-number ellipsis';
            ellipsis.textContent = '...';
            return ellipsis;
        }
        
        // è·³è½¬åˆ°æŒ‡å®šé¡µ
        function goToPage(page) {
            if (page >= 1 && page <= Math.ceil(playbooks.length / itemsPerPage)) {
                currentPage = page;
                renderPlaybooks();
            }
        }
        
        // ç‚¹å‡»ModalèƒŒæ™¯å…³é—­
        function setupModalEvents() {
            const modal = document.getElementById('playbook-modal');
            const closeBtn = document.getElementById('close-modal-btn');
            
            // å…³é—­æŒ‰é’®äº‹ä»¶
            closeBtn.addEventListener('click', closeModal);
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', function(event) {
                if (event.target === modal) {
                    closeModal();
                }
            });
        }
        
        // å¯†ç æ˜¾ç¤º/éšè—åŠŸèƒ½
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const eyeIcon = document.getElementById(inputId + '-eye');
            
            if (input.type === 'password') {
                input.type = 'text';
                eyeIcon.textContent = 'ğŸ™ˆ';
            } else {
                input.type = 'password';
                eyeIcon.textContent = 'ğŸ‘ï¸';
            }
        }
        
        // æµ‹è¯•è¿æ¥åŠŸèƒ½
        async function testConnection() {
            const testBtn = document.getElementById('test-connection-btn');
            const connectionStatus = document.getElementById('connection-status');
            
            testBtn.disabled = true;
            testBtn.textContent = 'æµ‹è¯•ä¸­...';
            connectionStatus.textContent = 'æµ‹è¯•ä¸­...';
            connectionStatus.className = 'status-warning';
            
            try {
                const response = await apiCall('/api/admin/config/test', {
                    method: 'POST',
                    body: JSON.stringify({}) // å‘é€ç©ºå¯¹è±¡ï¼Œä½¿ç”¨å½“å‰æ•°æ®åº“é…ç½®
                });

                if (!response) return;
                
                const data = await response.json();
                
                if (data.success) {
                    connectionStatus.textContent = 'è¿æ¥æˆåŠŸ';
                    connectionStatus.className = 'status-success';
                    showAlert('APIè¿æ¥æµ‹è¯•æˆåŠŸï¼', 'success');
                } else {
                    connectionStatus.textContent = 'è¿æ¥å¤±è´¥';
                    connectionStatus.className = 'status-error';
                    showAlert(`è¿æ¥æµ‹è¯•å¤±è´¥: ${data.message}`, 'error');
                }
            } catch (error) {
                connectionStatus.textContent = 'è¿æ¥å¤±è´¥';
                connectionStatus.className = 'status-error';
                showAlert(`è¿æ¥æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
            
            testBtn.disabled = false;
            testBtn.textContent = 'æµ‹è¯•è¿æ¥';
        }
        
        // ä¿å­˜é…ç½®åŠŸèƒ½
        async function saveConfiguration() {
            const saveBtn = document.getElementById('save-config-btn');
            const configValid = document.getElementById('config-valid');
            const configUpdated = document.getElementById('config-updated');
            
            saveBtn.disabled = true;
            saveBtn.textContent = 'ä¿å­˜ä¸­...';
            
            // æ”¶é›†é…ç½®æ•°æ®
            const apiUrl = document.getElementById('soar-api-url').value.trim();
            const apiToken = document.getElementById('soar-api-token').value.trim();
            const timeout = parseInt(document.getElementById('soar-timeout').value);
            const syncInterval = parseInt(document.getElementById('sync-interval').value);

            // æ”¶é›†æ ‡ç­¾
            const labelElements = document.querySelectorAll('.label-tag .label-name');
            const labels = Array.from(labelElements).map(el => el.textContent.trim()).filter(label => label);

            // æ„å»ºé…ç½®æ•°æ®
            const configData = {
                soar_api_url: apiUrl,
                soar_timeout: timeout,
                sync_interval: syncInterval,
                soar_labels: labels
            };
            
            // æ£€æŸ¥Tokenæ˜¯å¦è¢«ä¿®æ”¹ï¼ˆå¦‚æœä¸æ˜¯æ‰“ç æ ¼å¼ï¼Œè¯´æ˜ç”¨æˆ·è¾“å…¥äº†æ–°Tokenï¼‰
            if (!apiToken.includes('***')) {
                configData.soar_api_token = apiToken;
            }
            // å¦‚æœæ˜¯æ‰“ç æ ¼å¼ï¼Œåˆ™ä¸åŒ…å«Tokenå­—æ®µï¼Œåç«¯ä¼šä¿æŒåŸæœ‰Token
            
            // éªŒè¯å¿…å¡«é¡¹
            if (!apiUrl || !apiToken || !timeout || labels.length === 0) {
                showAlert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹å¹¶è‡³å°‘æ·»åŠ ä¸€ä¸ªæ ‡ç­¾', 'error');
                saveBtn.disabled = false;
                saveBtn.textContent = 'ä¿å­˜é…ç½®';
                return;
            }
            
            try {
                const response = await apiCall('/api/admin/config', {
                    method: 'POST',
                    body: JSON.stringify(configData)
                });

                if (!response) return;
                
                const data = await response.json();
                
                if (data.success) {
                    configValid.textContent = 'é…ç½®æœ‰æ•ˆ';
                    configValid.className = 'status-success';
                    configUpdated.textContent = new Date().toLocaleString('zh-CN');
                    showAlert('é…ç½®ä¿å­˜æˆåŠŸï¼', 'success');
                } else {
                    configValid.textContent = 'é…ç½®æ— æ•ˆ';
                    configValid.className = 'status-error';
                    showAlert(`é…ç½®ä¿å­˜å¤±è´¥: ${data.message}`, 'error');
                }
            } catch (error) {
                configValid.textContent = 'é…ç½®æ— æ•ˆ';
                configValid.className = 'status-error';
                showAlert(`é…ç½®ä¿å­˜å¤±è´¥: ${error.message}`, 'error');
            }
            
            saveBtn.disabled = false;
            saveBtn.textContent = 'ä¿å­˜é…ç½®';
        }
        
        // æ ‡ç­¾ç®¡ç†åŠŸèƒ½
        function addLabel() {
            const labelInput = document.getElementById('label-input');
            const labelsList = document.getElementById('labels-list');
            const labelName = labelInput.value.trim();
            
            if (!labelName) {
                showAlert('è¯·è¾“å…¥æ ‡ç­¾åç§°', 'warning');
                return;
            }
            
            // æ£€æŸ¥é‡å¤
            const existingLabels = Array.from(document.querySelectorAll('.label-tag .label-name'))
                .map(el => el.textContent.trim());
            
            if (existingLabels.includes(labelName)) {
                showAlert('æ ‡ç­¾å·²å­˜åœ¨', 'warning');
                return;
            }
            
            // åˆ›å»ºæ ‡ç­¾å…ƒç´ 
            const labelElement = document.createElement('div');
            labelElement.className = 'label-tag';
            labelElement.innerHTML = `
                <span class="label-name">${labelName}</span>
                <button type="button" class="label-remove" onclick="this.parentElement.remove()">Ã—</button>
            `;
            
            labelsList.appendChild(labelElement);
            labelInput.value = '';
        }
        
        // åˆå§‹åŒ–
        // åŠ è½½ç³»ç»Ÿé…ç½®
        async function loadSystemConfig() {
            try {
                const response = await apiCall('/api/admin/config');
                if (!response) return;

                const data = await response.json();
                
                if (data.success && data.data) {
                    // å¡«å……è¡¨å•å­—æ®µ
                    document.getElementById('soar-api-url').value = data.data.soar_api_url || '';
                    document.getElementById('soar-api-token').value = data.data.soar_api_token || '';
                    document.getElementById('soar-timeout').value = data.data.soar_timeout || 30;
                    document.getElementById('sync-interval').value = data.data.sync_interval || 14400;
                    
                    // å¡«å……æ ‡ç­¾åˆ—è¡¨
                    const labelsList = document.getElementById('labels-list');
                    labelsList.innerHTML = '';
                    
                    const labels = data.data.soar_labels && Array.isArray(data.data.soar_labels) 
                        ? data.data.soar_labels 
                        : ['MCP']; // é»˜è®¤æ˜¾ç¤ºMCPæ ‡ç­¾
                    
                    labels.forEach(label => {
                        const labelElement = document.createElement('div');
                        labelElement.className = 'label-tag';
                        labelElement.innerHTML = `
                            <span class="label-name">${label}</span>
                            <button type="button" class="label-remove" onclick="this.parentElement.remove()">Ã—</button>
                        `;
                        labelsList.appendChild(labelElement);
                    });
                }
            } catch (error) {
                console.error('åŠ è½½ç³»ç»Ÿé…ç½®å¤±è´¥:', error);
                showAlert('åŠ è½½ç³»ç»Ÿé…ç½®å¤±è´¥', 'error');
                
                // å³ä½¿åŠ è½½å¤±è´¥ï¼Œä¹Ÿæ˜¾ç¤ºé»˜è®¤çš„MCPæ ‡ç­¾
                const labelsList = document.getElementById('labels-list');
                labelsList.innerHTML = '';
                const labelElement = document.createElement('div');
                labelElement.className = 'label-tag';
                labelElement.innerHTML = `
                    <span class="label-name">MCP</span>
                    <button type="button" class="label-remove" onclick="this.parentElement.remove()">Ã—</button>
                `;
                labelsList.appendChild(labelElement);
            }
        }

        // Tokenç®¡ç†åŠŸèƒ½
        let tokens = [];

        // åŠ è½½Tokenåˆ—è¡¨
        async function loadTokens() {
            try {
                const response = await apiCall('/api/admin/tokens');
                if (!response) return;

                const result = await response.json();

                if (result.success) {
                    tokens = result.data;
                    renderTokens();
                } else {
                    showAlert(result.error || 'åŠ è½½Tokenæ•°æ®å¤±è´¥', 'error');
                    document.getElementById('tokens-tbody').innerHTML = `
                        <tr>
                            <td colspan="7" class="loading">
                                <div>åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                showAlert('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                document.getElementById('tokens-tbody').innerHTML = `
                    <tr>
                        <td colspan="7" class="loading">
                            <div>ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥</div>
                        </td>
                    </tr>
                `;
            }
        }

        // æ¸²æŸ“Tokenè¡¨æ ¼
        function renderTokens() {
            const tokensTable = document.getElementById('tokens-tbody');

            if (tokens.length === 0) {
                tokensTable.innerHTML = `
                    <tr>
                        <td colspan="7" class="loading">
                            <div>æš‚æ— Tokenæ•°æ®</div>
                        </td>
                    </tr>
                `;
                return;
            }

            tokensTable.innerHTML = tokens.map(token => {
                const isExpired = token.expires_at && new Date(token.expires_at) < new Date();
                const maskedToken = token.token.substring(0, 8) + '***' + token.token.substring(token.token.length - 4);

                return `
                    <tr>
                        <td>${token.name}</td>
                        <td>
                            <span class="playbook-id" style="font-size: 0.8rem; cursor: default;">${maskedToken}</span>
                        </td>
                        <td style="white-space: nowrap; font-size: 0.85rem;">${formatDate(token.created_at)}</td>
                        <td style="white-space: nowrap; font-size: 0.85rem;">${token.expires_at ? formatDate(token.expires_at) : 'æ°¸ä¸è¿‡æœŸ'}</td>
                        <td style="white-space: nowrap; font-size: 0.85rem;">${formatDate(token.last_used_at)}</td>
                        <td>
                            <span style="color: ${isExpired ? '#fca5a5' : (token.is_active ? '#ffffff' : '#d1d5db')}; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);">
                                ${isExpired ? 'å·²è¿‡æœŸ' : (token.is_active ? 'æ´»è·ƒ' : 'ç¦ç”¨')}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;"
                                    onclick="deleteToken(${token.id})">åˆ é™¤</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // æ˜¾ç¤ºåˆ›å»ºTokenæ¨¡æ€æ¡†
        function showCreateTokenModal() {
            document.getElementById('create-token-modal').style.display = 'block';
            document.getElementById('token-name').value = '';
            document.getElementById('token-expires').value = '';
        }

        // å…³é—­åˆ›å»ºTokenæ¨¡æ€æ¡†
        function closeCreateTokenModal() {
            document.getElementById('create-token-modal').style.display = 'none';
        }

        // åˆ›å»ºToken
        async function createToken() {
            const name = document.getElementById('token-name').value.trim();
            const expiresInDays = document.getElementById('token-expires').value;

            if (!name) {
                showAlert('è¯·è¾“å…¥Tokenåç§°', 'error');
                return;
            }

            try {
                const response = await apiCall('/api/admin/tokens', {
                    method: 'POST',
                    body: JSON.stringify({
                        name: name,
                        expires_in_days: expiresInDays ? parseInt(expiresInDays) : null
                    })
                });

                if (!response) return;

                const result = await response.json();

                if (result.success) {
                    closeCreateTokenModal();

                    // æ˜¾ç¤ºæ–°åˆ›å»ºçš„Tokenå€¼
                    document.getElementById('new-token-value').value = result.token;

                    // ç”Ÿæˆå®Œæ•´çš„MCP URL
                    const currentHost = window.location.host;
                    const mcpUrl = `http://${currentHost.replace(':12346', ':12345')}/mcp?token=${result.token}`;
                    document.getElementById('new-mcp-url').value = mcpUrl;

                    document.getElementById('show-token-modal').style.display = 'block';

                    // é‡æ–°åŠ è½½Tokenåˆ—è¡¨
                    loadTokens();
                    showAlert('Tokenåˆ›å»ºæˆåŠŸï¼', 'success');
                } else {
                    showAlert(result.error || 'Tokenåˆ›å»ºå¤±è´¥', 'error');
                }
            } catch (error) {
                showAlert('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
            }
        }

        // å…³é—­æ˜¾ç¤ºTokenå€¼æ¨¡æ€æ¡†
        function closeShowTokenModal() {
            document.getElementById('show-token-modal').style.display = 'none';
            document.getElementById('new-token-value').value = '';
            document.getElementById('new-mcp-url').value = '';
        }

        // å¤åˆ¶Tokenåˆ°å‰ªè´´æ¿
        async function copyTokenToClipboard() {
            const tokenInput = document.getElementById('new-token-value');
            try {
                await navigator.clipboard.writeText(tokenInput.value);
                showCopySuccessAlert('Tokenå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            } catch (error) {
                // å…¼å®¹æ—§æµè§ˆå™¨
                tokenInput.select();
                document.execCommand('copy');
                showCopySuccessAlert('Tokenå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }
        }

        // å¤åˆ¶MCP URLåˆ°å‰ªè´´æ¿
        async function copyMcpUrlToClipboard() {
            const mcpUrlInput = document.getElementById('new-mcp-url');
            try {
                await navigator.clipboard.writeText(mcpUrlInput.value);
                showCopySuccessAlert('MCP URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            } catch (error) {
                // å…¼å®¹æ—§æµè§ˆå™¨
                mcpUrlInput.select();
                document.execCommand('copy');
                showCopySuccessAlert('MCP URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }
        }

        // åˆ é™¤Token
        async function deleteToken(tokenId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªTokenå—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) {
                return;
            }

            try {
                const response = await apiCall(`/api/admin/tokens/${tokenId}`, {
                    method: 'DELETE'
                });

                if (!response) return;

                const result = await response.json();

                if (result.success) {
                    showAlert('Tokenåˆ é™¤æˆåŠŸ', 'success');
                    loadTokens(); // é‡æ–°åŠ è½½Tokenåˆ—è¡¨
                } else {
                    showAlert(result.error || 'Tokenåˆ é™¤å¤±è´¥', 'error');
                }
            } catch (error) {
                showAlert('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
            }
        }

        // å°†refreshStatså®šä¹‰ä¸ºå…¨å±€å‡½æ•°
        function refreshStats() {
            // è·å–æ‰€æœ‰ç»Ÿè®¡ä¿¡æ¯ï¼ˆåŒ…æ‹¬å‰§æœ¬å’Œåº”ç”¨ç»Ÿè®¡ï¼‰
            apiCall('/api/admin/stats')
                .then(response => {
                    if (!response) return;
                    return response.json();
                })
                .then(data => {
                    if (!data) return;
                    if (data.success && data.stats) {
                        // æ›´æ–°å‰§æœ¬ç»Ÿè®¡
                        document.getElementById('total-playbooks').textContent = data.stats.total_playbooks || '-';
                        document.getElementById('enabled-playbooks').textContent = data.stats.enabled_playbooks || '-';
                        document.getElementById('disabled-playbooks').textContent = data.stats.disabled_playbooks || '-';
                        
                        // æ›´æ–°åº”ç”¨ç»Ÿè®¡
                        document.getElementById('total-apps').textContent = data.stats.total_apps || '-';
                        
                        // æ›´æ–°æœ€ååŒæ­¥æ—¶é—´
                        if (data.stats.last_sync_time) {
                            // ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œé¿å…æ—¶åŒºè½¬æ¢é—®é¢˜
                            document.getElementById('last-sync').textContent = data.stats.last_sync_time;
                        }
                    }
                })
                .catch(error => console.error('Error fetching stats:', error));
        }
        
        // Tabåˆ‡æ¢åŠŸèƒ½
        function showTab(tabName) {
            // éšè—æ‰€æœ‰section
            document.getElementById('playbooks-section').style.display = 'none';
            document.getElementById('tokens-section').style.display = 'none';
            document.getElementById('config-section').style.display = 'none';
            document.getElementById('stats-section').style.display = 'none';

            // ç§»é™¤æ‰€æœ‰å¯¼èˆªé¡¹çš„activeç±»
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // æ˜¾ç¤ºå¯¹åº”çš„section
            if (tabName === 'playbooks') {
                document.getElementById('playbooks-section').style.display = 'block';
                document.getElementById('nav-playbooks').classList.add('active');
            } else if (tabName === 'tokens') {
                document.getElementById('tokens-section').style.display = 'block';
                document.getElementById('nav-tokens').classList.add('active');
                loadTokens(); // åŠ è½½Tokenåˆ—è¡¨
            } else if (tabName === 'config') {
                document.getElementById('config-section').style.display = 'block';
                document.getElementById('nav-config').classList.add('active');
                loadSystemConfig(); // åŠ è½½ç³»ç»Ÿé…ç½®
            } else if (tabName === 'stats') {
                document.getElementById('stats-section').style.display = 'block';
                document.getElementById('nav-stats').classList.add('active');
                refreshStats(); // åˆ·æ–°ç»Ÿè®¡ä¿¡æ¯
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥è®¤è¯
            if (!checkAuth()) {
                return; // checkAuthä¼šå¤„ç†è·³è½¬
            }

            // æ·»åŠ å¯¼èˆªäº‹ä»¶ç›‘å¬å™¨
            document.getElementById('nav-playbooks').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('playbooks');
            });

            document.getElementById('nav-tokens').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('tokens');
            });

            document.getElementById('nav-config').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('config');
            });

            document.getElementById('nav-stats').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('stats');
            });

            // æ³¨é”€æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
            document.getElementById('logout-btn').addEventListener('click', (e) => {
                e.preventDefault();
                logout();
            });
            setupModalEvents();
            
            // è®¾ç½®åˆ†é¡µæŒ‰é’®äº‹ä»¶
            prevPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    goToPage(currentPage - 1);
                }
            });
            
            nextPageBtn.addEventListener('click', () => {
                const totalPages = Math.ceil(playbooks.length / itemsPerPage);
                if (currentPage < totalPages) {
                    goToPage(currentPage + 1);
                }
            });
            
            loadPlaybooks();
            
            // å®šæœŸåˆ·æ–°ï¼ˆæ¯30ç§’ï¼‰
            setInterval(loadPlaybooks, 30000);

            // æ·»åŠ ç»ç’ƒæ‹Ÿæ€äº¤äº’æ•ˆæœ
            initGlassmorphismEffects();
        });

        // ç»ç’ƒæ‹Ÿæ€äº¤äº’æ•ˆæœ
        function initGlassmorphismEffects() {
            // æ·»åŠ é¼ æ ‡è·Ÿè¸ªæ•ˆæœ
            document.addEventListener('mousemove', (e) => {
                const shapes = document.querySelectorAll('.floating-shape');
                const x = e.clientX / window.innerWidth;
                const y = e.clientY / window.innerHeight;

                shapes.forEach((shape, index) => {
                    const speed = (index + 1) * 0.3;
                    const xOffset = (x - 0.5) * speed * 30;
                    const yOffset = (y - 0.5) * speed * 30;

                    shape.style.transform += ` translate(${xOffset}px, ${yOffset}px)`;
                });
            });

            // ä¸ºå¡ç‰‡æ·»åŠ æ‚¬æµ®æ•ˆæœ
            // å·²ç§»é™¤cardæ‚¬åœè·³åŠ¨åŠ¨ç”»ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

            // ä¸ºæŒ‰é’®æ·»åŠ æ³¢çº¹æ•ˆæœ
            const buttons = document.querySelectorAll('.btn, .nav-item');
            buttons.forEach(button => {
                button.addEventListener('click', function(e) {
                    const ripple = document.createElement('span');
                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;

                    ripple.style.cssText = `
                        position: absolute;
                        width: ${size}px;
                        height: ${size}px;
                        left: ${x}px;
                        top: ${y}px;
                        background: rgba(255, 255, 255, 0.3);
                        border-radius: 50%;
                        transform: scale(0);
                        animation: ripple 0.6s linear;
                        pointer-events: none;
                    `;

                    this.appendChild(ripple);

                    setTimeout(() => {
                        ripple.remove();
                    }, 600);
                });
            });

            // æ·»åŠ rippleåŠ¨ç”»æ ·å¼
            if (!document.getElementById('ripple-style')) {
                const style = document.createElement('style');
                style.id = 'ripple-style';
                style.textContent = `
                    @keyframes ripple {
                        to {
                            transform: scale(2);
                            opacity: 0;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
        }
    </script>

    <!-- åº•éƒ¨ä¿¡æ¯ -->
    <footer class="footer">
        <div class="footer-content">
            é›¾å¸œæ™ºèƒ½@2025 <a href="https://flagify.com" target="_blank">æœ€ç‰›çš„SOAR</a> <a href="https://github.com/flagify-com/OctoMation/wiki" target="_blank">OctoMation</a> | <a href="https://github.com/flagify-com/soar-mcp" target="_blank">ğŸ“¦ Githubé¡¹ç›®</a>
        </div>
    </footer>
</body>
</html>