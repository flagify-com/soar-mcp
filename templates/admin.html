<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOAR MCP Server ç®¡ç†åå°</title>
    <link rel="stylesheet" href="/static/fonts/fonts.css">
    <style>
        /* ===== Cyber Shield Design System ===== */
        :root {
            /* Surface */
            --bg-body: #f0f2f5;
            --bg-surface: #ffffff;
            --bg-surface-hover: #f8fafc;
            --bg-header: #0f172a;

            /* Brand */
            --accent-indigo: #6366f1;
            --accent-cyan: #06b6d4;
            --accent-emerald: #10b981;
            --accent-amber: #f59e0b;
            --accent-rose: #f43f5e;

            /* Text */
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --text-inverse: #f8fafc;

            /* Borders */
            --border-light: #e2e8f0;
            --border-hover: #cbd5e1;

            /* Shadows */
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.06);
            --shadow-lg: 0 12px 32px rgba(0,0,0,0.08);
            --shadow-glow: 0 0 24px rgba(99,102,241,0.12);

            /* Radius */
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;

            /* Fonts */
            --font-sans: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
        }

        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            height: 100%;
            font-family: var(--font-sans);
            overflow-x: hidden;
            color: var(--text-primary);
            background: var(--bg-body);
            -webkit-font-smoothing: antialiased;
        }

        /* ===== Header ===== */
        .header {
            background: var(--bg-header);
            padding: 0 2rem;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(99, 102, 241, 0.15);
            box-shadow: 0 1px 0 rgba(99, 102, 241, 0.08);
        }

        .header h1 {
            color: var(--text-inverse);
            font-size: 1.15rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header h1 img {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .nav {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .nav-left {
            display: flex;
            gap: 4px;
        }

        .nav-right {
            display: flex;
            gap: 4px;
            margin-left: 12px;
        }

        .nav-item {
            display: inline-flex;
            align-items: center;
            color: var(--text-muted);
            text-decoration: none;
            padding: 6px 14px;
            border-radius: 8px;
            background: transparent;
            border: 1px solid transparent;
            transition: all 0.2s ease;
            font-weight: 600;
            font-size: 0.82rem;
            letter-spacing: 0.01em;
            cursor: pointer;
        }

        .nav-item:hover {
            color: var(--text-inverse);
            background: rgba(255, 255, 255, 0.06);
        }

        .nav-item.active {
            color: var(--text-inverse);
            background: rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.3);
        }

        .nav-item.logout {
            color: #fda4af;
            background: transparent;
            border: 1px solid transparent;
        }

        .nav-item.logout:hover {
            background: rgba(244, 63, 94, 0.15);
            border-color: rgba(244, 63, 94, 0.2);
            color: #fecdd3;
        }

        /* ===== Main Container ===== */
        .container {
            max-width: 1360px;
            margin: 0 auto;
            padding: 1.5rem 2rem;
            min-height: calc(100vh - 64px - 72px);
        }

        /* ===== Cards ===== */
        .card {
            background: var(--bg-surface);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            margin-bottom: 1.5rem;
            position: relative;
            color: var(--text-primary);
            transition: box-shadow 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--accent-indigo), var(--accent-cyan));
            border-radius: var(--radius-lg) 0 0 var(--radius-lg);
            z-index: 1;
        }

        .card-header {
            background: var(--bg-surface);
            padding: 1.25rem 1.75rem;
            padding-left: 2rem;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 2;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-primary);
            letter-spacing: -0.01em;
        }

        .stats {
            display: flex;
            gap: 8px;
        }

        .stat-item {
            background: var(--bg-body);
            color: var(--text-secondary);
            padding: 5px 12px;
            border-radius: 20px;
            min-width: fit-content;
            white-space: nowrap;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid var(--border-light);
        }

        /* ===== Table ===== */
        .table-container {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: var(--bg-body);
            color: var(--text-secondary);
            font-weight: 700;
            padding: 0.75rem 1.5rem;
            text-align: left;
            border-bottom: 1px solid var(--border-light);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.06em;
        }

        .table td {
            padding: 0.85rem 1.5rem;
            border-bottom: 1px solid var(--border-light);
            vertical-align: middle;
            color: var(--text-primary);
            font-size: 0.875rem;
        }

        .table tbody tr {
            transition: background 0.15s ease;
        }

        .table tbody tr:hover {
            background: var(--bg-surface-hover);
        }

        .table tbody tr:last-child td {
            border-bottom: none;
        }

        /* ===== Switch ===== */
        .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: #cbd5e1;
            transition: all 0.25s ease;
            border-radius: 24px;
            border: none;
            box-shadow: none;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background: white;
            transition: all 0.25s ease;
            border-radius: 50%;
            box-shadow: 0 1px 3px rgba(0,0,0,0.15);
        }

        input:checked + .slider {
            background: var(--accent-indigo);
            box-shadow: none;
            border: none;
        }

        input:checked + .slider:before {
            transform: translateX(20px);
            background: white;
        }

        /* ===== Badges ===== */
        .category-badge {
            display: inline-block;
            background: var(--bg-body);
            color: var(--text-secondary);
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.72rem;
            font-weight: 600;
            border: 1px solid var(--border-light);
        }

        .playbook-id {
            font-family: var(--font-mono);
            color: var(--accent-indigo);
            font-weight: 600;
            font-size: 0.82rem;
            cursor: pointer;
            transition: color 0.15s ease;
            letter-spacing: -0.02em;
        }

        .playbook-id:hover {
            color: #4338ca;
            text-decoration: underline;
            text-underline-offset: 2px;
        }

        .playbook-display-name {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 0.875rem;
        }

        /* ===== States ===== */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
            font-size: 0.875rem;
        }

        .error {
            background: #fef2f2;
            color: #b91c1c;
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            margin-bottom: 1rem;
            border: 1px solid #fecaca;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .success {
            background: #ecfdf5;
            color: #065f46;
            padding: 12px 16px;
            border-radius: var(--radius-sm);
            margin-bottom: 1rem;
            border: 1px solid #a7f3d0;
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* ===== Modal ===== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            inset: 0;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(8px);
        }

        .modal-content {
            background: var(--bg-surface);
            margin: 4vh auto;
            padding: 0;
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 900px;
            max-height: 88vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg), var(--shadow-glow);
            border: 1px solid var(--border-light);
        }

        .modal-header {
            background: var(--bg-header);
            color: var(--text-inverse);
            padding: 1.25rem 1.75rem;
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.05rem;
            font-weight: 700;
            margin: 0;
            letter-spacing: -0.01em;
        }

        .close {
            color: var(--text-muted);
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            line-height: 1;
            transition: color 0.15s ease;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        .close:hover {
            color: var(--text-inverse);
            background: rgba(255, 255, 255, 0.1);
        }

        .modal-body {
            padding: 1.75rem;
            background: var(--bg-surface);
            border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        }

        .detail-section {
            margin-bottom: 1.5rem;
        }

        .detail-section:last-child {
            margin-bottom: 0;
        }

        .detail-row-inline {
            display: flex;
            gap: 2rem;
            margin-bottom: 1.5rem;
        }

        .detail-row-inline .detail-section {
            margin-bottom: 0;
        }

        .detail-timestamps {
            display: flex;
            gap: 2rem;
            margin-bottom: 1.5rem;
        }

        .detail-timestamps .detail-section {
            flex: 1;
            margin-bottom: 0;
        }

        .detail-label {
            font-weight: 700;
            color: var(--text-muted);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 4px;
        }

        .detail-value {
            color: var(--text-primary);
            font-size: 0.9rem;
            line-height: 1.6;
            font-weight: 500;
        }

        .param-item {
            background: var(--bg-body);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            padding: 14px;
            margin-bottom: 10px;
        }

        .param-item:last-child {
            margin-bottom: 0;
        }

        .param-name {
            font-weight: 700;
            color: var(--accent-indigo);
            margin-bottom: 6px;
            font-size: 0.875rem;
        }

        .param-type {
            display: inline-block;
            background: var(--accent-indigo);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.68rem;
            font-weight: 600;
            margin-right: 6px;
            font-family: var(--font-mono);
        }

        .param-required {
            color: var(--accent-rose);
            font-size: 0.72rem;
            font-weight: 700;
        }

        .param-description {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-top: 6px;
            line-height: 1.5;
        }

        /* ===== Footer ===== */
        .footer {
            margin-top: 2rem;
            padding: 1.25rem 0;
            text-align: center;
            background: var(--bg-header);
            border-top: 1px solid rgba(99, 102, 241, 0.1);
            position: relative;
        }

        .footer-content {
            color: var(--text-muted);
            font-size: 0.78rem;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        .footer-content a {
            color: var(--accent-cyan);
            text-decoration: none;
            font-weight: 600;
            margin: 0 6px;
            transition: color 0.2s ease;
        }

        .footer-content a:hover {
            color: var(--accent-indigo);
        }

        /* ===== Responsive ===== */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .header {
                padding: 0 1rem;
                height: 56px;
            }

            .header h1 { font-size: 1rem; }

            .card-header {
                padding: 1rem 1.25rem;
                flex-direction: column;
                gap: 0.75rem;
                align-items: flex-start;
            }

            .table th, .table td {
                padding: 0.65rem 0.75rem;
                font-size: 0.8rem;
            }

            .stats { flex-wrap: wrap; }

            .modal-content {
                width: 96%;
                margin: 2vh auto;
            }

            .modal-header, .modal-body {
                padding: 1rem;
            }

            .nav {
                flex-wrap: wrap;
                gap: 4px;
            }
        }

        /* ===== Pagination ===== */
        .pagination-container {
            margin: 0;
            display: flex;
            justify-content: flex-end;
            align-items: center;
            padding: 12px 1.5rem;
            border-top: 1px solid var(--border-light);
            gap: 1rem;
        }

        .pagination-info {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-weight: 500;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .pagination-btn {
            padding: 6px 14px;
            border: 1px solid var(--border-light);
            background: var(--bg-surface);
            color: var(--text-secondary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            font-size: 0.8rem;
            font-weight: 600;
            font-family: var(--font-sans);
        }

        .pagination-btn:hover:not(:disabled) {
            background: var(--bg-body);
            border-color: var(--accent-indigo);
            color: var(--accent-indigo);
        }

        .pagination-btn:disabled {
            background: var(--bg-body);
            color: var(--text-muted);
            cursor: not-allowed;
            border-color: var(--border-light);
        }

        .page-numbers {
            display: flex;
            gap: 2px;
        }

        .page-number {
            padding: 6px 10px;
            border: 1px solid var(--border-light);
            background: var(--bg-surface);
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s ease;
            font-size: 0.8rem;
            font-weight: 600;
            min-width: 34px;
            text-align: center;
            font-family: var(--font-sans);
        }

        .page-number:hover {
            background: var(--bg-body);
            border-color: var(--accent-indigo);
            color: var(--accent-indigo);
        }

        .page-number.active {
            background: var(--accent-indigo);
            border-color: var(--accent-indigo);
            color: white;
        }

        .page-number.ellipsis {
            cursor: default;
            border-color: transparent;
            background: transparent;
        }

        .page-number.ellipsis:hover {
            background: transparent;
            color: var(--text-secondary);
        }

        /* ===== Buttons ===== */
        .config-actions {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.82rem;
            font-weight: 600;
            font-family: var(--font-sans);
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: var(--accent-indigo);
            color: white;
            border: 1px solid transparent;
            box-shadow: 0 1px 3px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            background: #4f46e5;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.35);
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--bg-body);
            color: var(--text-secondary);
            border: 1px solid var(--border-light);
        }

        .btn-secondary:hover {
            background: var(--bg-surface);
            border-color: var(--border-hover);
            color: var(--text-primary);
            transform: translateY(-1px);
        }

        /* ===== Config Section ===== */
        .config-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            padding: 1.75rem;
        }

        .config-form {
            display: flex;
            flex-direction: column;
            gap: 1.25rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group .label-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .form-group label {
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
            font-size: 0.85rem;
        }

        .form-group .form-help {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin: 0;
            font-style: normal;
        }

        #sync-interval { max-width: 150px; }

        .form-input {
            padding: 9px 12px;
            border: 1px solid var(--border-light);
            border-radius: var(--radius-sm);
            font-size: 0.875rem;
            font-family: var(--font-sans);
            color: var(--text-primary);
            background: var(--bg-surface);
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-indigo);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-help {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .password-input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .password-input-container .form-input {
            padding-right: 3rem;
            width: 100%;
            min-width: 360px;
        }

        .password-toggle {
            position: absolute;
            right: 10px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            font-size: 0.9rem;
            color: var(--text-muted);
            z-index: 1;
        }

        .password-toggle:hover { color: var(--text-primary); }

        .status-success { color: var(--accent-emerald); font-weight: 700; }
        .status-error { color: var(--accent-rose); font-weight: 700; }
        .status-warning { color: var(--accent-amber); font-weight: 700; }

        #soar-timeout { max-width: 120px; }

        .labels-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .labels-input {
            display: flex;
            gap: 8px;
        }

        .labels-input .form-input { flex: 1; }

        .labels-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            min-height: 2rem;
        }

        .label-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: rgba(99, 102, 241, 0.08);
            color: var(--accent-indigo);
            border-radius: 20px;
            font-size: 0.78rem;
            font-weight: 600;
            border: 1px solid rgba(99, 102, 241, 0.15);
        }

        .label-tag .remove-label {
            background: none;
            border: none;
            color: var(--accent-indigo);
            cursor: pointer;
            font-size: 0.9rem;
            line-height: 1;
            padding: 0;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.15s ease;
        }

        .label-tag .remove-label:hover {
            background: var(--accent-indigo);
            color: white;
        }

        .config-status {
            background: var(--bg-body);
            padding: 1.25rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-light);
        }

        .config-status h3 {
            margin-bottom: 1rem;
            color: var(--text-primary);
            font-size: 0.95rem;
            font-weight: 700;
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-light);
            font-size: 0.85rem;
        }

        .status-item:last-child { border-bottom: none; }

        .status-label {
            font-weight: 600;
            color: var(--text-secondary);
        }

        .status-value {
            color: var(--text-muted);
            font-weight: 500;
        }

        .status-success { color: var(--accent-emerald) !important; }
        .status-error { color: var(--accent-rose) !important; }
        .status-warning { color: var(--accent-amber) !important; }

        /* ===== Stats Page ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
            padding: 0 0.5rem;
        }

        .stat-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-light);
            padding: 1.5rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            transition: all 0.25s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--accent-indigo), var(--accent-cyan));
            border-radius: var(--radius-md) 0 0 var(--radius-md);
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--border-hover);
        }

        .stat-card h3 {
            margin: 0 0 1rem 0;
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 700;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-light);
        }

        .stats-grid .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 10px 12px;
            border-radius: var(--radius-sm);
            background: var(--bg-body);
            border: 1px solid var(--border-light);
            transition: all 0.15s ease;
        }

        .stats-grid .stat-item:hover {
            background: rgba(99, 102, 241, 0.04);
            border-color: rgba(99, 102, 241, 0.15);
        }

        .stats-grid .stat-item:last-child { margin-bottom: 0; }

        .stat-label {
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .stat-value {
            font-weight: 700;
            color: var(--text-primary);
            font-family: var(--font-mono);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .config-container {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .labels-input { flex-direction: column; }
            .config-actions { flex-direction: column; }
            .password-input-container .form-input { min-width: 100%; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>
            <img src="/static/logo.webp" alt="SOAR MCP Server">
            SOAR MCP Server
        </h1>
        <nav class="nav">
            <div class="nav-left">
                <a href="#" class="nav-item active" id="nav-playbooks">å‰§æœ¬ç®¡ç†</a>
                <a href="#" class="nav-item" id="nav-tokens">Tokenç®¡ç†</a>
                <a href="#" class="nav-item" id="nav-config">ç³»ç»Ÿé…ç½®</a>
                <a href="#" class="nav-item" id="nav-stats">ç»Ÿè®¡ä¿¡æ¯</a>
            </div>
            <div class="nav-right">
                <a href="#" class="nav-item logout" id="logout-btn">æ³¨é”€</a>
            </div>
        </nav>
    </div>
    
    <div class="container">
        <div id="alert-container"></div>
        
        <!-- å‰§æœ¬è¯¦æƒ… Modal -->
        <div id="playbook-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">å‰§æœ¬è¯¦æƒ…</h3>
                    <button class="close" id="close-modal-btn">&times;</button>
                </div>
                <div class="modal-body" id="modal-body">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
        
        <div class="card" id="playbooks-section">
            <div class="card-header">
                <h2 class="card-title">å‰§æœ¬ç®¡ç†</h2>
                <div class="stats" id="playbook-stats">
                    <div class="stat-item">æ€»è®¡: <span id="total-count">-</span></div>
                    <div class="stat-item">å¯ç”¨: <span id="enabled-count">-</span></div>
                    <div class="stat-item">ç¦ç”¨: <span id="disabled-count">-</span></div>
                </div>
            </div>
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th width="20%">å‰§æœ¬ID</th>
                            <th width="40%">æ˜¾ç¤ºåç§°</th>
                            <th width="25%" style="white-space:nowrap">æœ€ååŒæ­¥</th>
                            <th width="15%">çŠ¶æ€</th>
                        </tr>
                    </thead>
                    <tbody id="playbooks-tbody">
                        <tr>
                            <td colspan="4" class="loading">
                                <div>æ­£åœ¨åŠ è½½å‰§æœ¬æ•°æ®...</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- åˆ†é¡µæ§ä»¶ -->
            <div class="pagination-container">
                <div class="pagination-info">
                    <span id="pagination-info">æ˜¾ç¤ºç¬¬ 1-20 æ¡ï¼Œå…± 0 æ¡</span>
                </div>
                <div class="pagination-controls">
                    <button id="prev-page" class="pagination-btn" disabled>ä¸Šä¸€é¡µ</button>
                    <div id="page-numbers" class="page-numbers"></div>
                    <button id="next-page" class="pagination-btn" disabled>ä¸‹ä¸€é¡µ</button>
                </div>
            </div>
        </div>

        <!-- Tokenç®¡ç†åŒºåŸŸ -->
        <div class="card" id="tokens-section" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">Tokenç®¡ç†</h2>
                <div class="config-actions">
                    <button id="create-token-btn" class="btn btn-primary" onclick="showCreateTokenModal()">åˆ›å»ºToken</button>
                </div>
            </div>
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th width="18%">Tokenåç§°</th>
                            <th width="20%">Tokenå€¼</th>
                            <th width="14%">åˆ›å»ºæ—¶é—´</th>
                            <th width="14%">è¿‡æœŸæ—¶é—´</th>
                            <th width="16%">æœ€åä½¿ç”¨</th>
                            <th width="10%">çŠ¶æ€</th>
                            <th width="8%">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="tokens-tbody">
                        <tr>
                            <td colspan="7" class="loading">
                                <div>æ­£åœ¨åŠ è½½Tokenæ•°æ®...</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- åˆ›å»ºToken Modal -->
        <div id="create-token-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">åˆ›å»ºæ–°Token</h3>
                    <button class="close" onclick="closeCreateTokenModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="token-name">Tokenåç§°</label>
                        <input type="text" id="token-name" class="form-input" placeholder="è¾“å…¥Tokenæè¿°åç§°" required>
                        <small class="form-help">ç”¨äºæ ‡è¯†æ­¤Tokençš„æè¿°æ€§åç§°</small>
                    </div>

                    <div class="form-group">
                        <label for="token-expires">è¿‡æœŸæ—¶é—´</label>
                        <select id="token-expires" class="form-input">
                            <option value="">æ°¸ä¸è¿‡æœŸ</option>
                            <option value="7">7å¤©åè¿‡æœŸ</option>
                            <option value="30">30å¤©åè¿‡æœŸ</option>
                            <option value="90">90å¤©åè¿‡æœŸ</option>
                        </select>
                        <small class="form-help">Tokençš„æœ‰æ•ˆæœŸï¼Œè¿‡æœŸåå°†è‡ªåŠ¨å¤±æ•ˆ</small>
                    </div>

                    <div class="config-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeCreateTokenModal()">å–æ¶ˆ</button>
                        <button type="button" class="btn btn-primary" onclick="createToken()">åˆ›å»ºToken</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ˜¾ç¤ºTokenå€¼ Modal -->
        <div id="show-token-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Tokenåˆ›å»ºæˆåŠŸ</h3>
                    <button class="close" onclick="closeShowTokenModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div style="background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 1rem; margin-bottom: 1.5rem;">
                        <div style="color: #dc2626; font-weight: 600; font-size: 0.9rem;">
                            âš ï¸ é‡è¦æç¤ºï¼šè¯·ç«‹å³å¤åˆ¶å¹¶ä¿å­˜ä»¥ä¸‹ä¿¡æ¯ï¼Œå…³é—­çª—å£åå°†æ— æ³•å†æ¬¡æŸ¥çœ‹å®Œæ•´Tokenï¼
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Tokenå€¼</label>
                        <div class="password-input-container">
                            <input type="text" id="new-token-value" class="form-input" readonly>
                            <button type="button" class="password-toggle" onclick="copyTokenToClipboard()">
                                <span>ğŸ“‹</span>
                            </button>
                        </div>
                        <small class="form-help">
                            ç”¨äºAPIè®¤è¯çš„è®¿é—®ä»¤ç‰Œ
                        </small>
                    </div>

                    <div class="form-group">
                        <label>å®Œæ•´MCP URL (Streamable HTTP)</label>
                        <div class="password-input-container">
                            <input type="text" id="new-mcp-url" class="form-input" readonly>
                            <button type="button" class="password-toggle" onclick="copyMcpUrlToClipboard()">
                                <span>ğŸ“‹</span>
                            </button>
                        </div>
                        <small class="form-help">
                            Streamable HTTPç±»å‹çš„MCPæœåŠ¡å™¨URLï¼Œå¯ç›´æ¥ç”¨äºClaude Desktopã€Cherry Studioç­‰MCPå®¢æˆ·ç«¯é…ç½®
                        </small>
                    </div>

                    <div class="config-actions">
                        <button type="button" class="btn btn-primary" onclick="copyTokenToClipboard()">å¤åˆ¶Token</button>
                        <button type="button" class="btn btn-primary" onclick="copyMcpUrlToClipboard()">å¤åˆ¶MCP URL</button>
                        <button type="button" class="btn btn-secondary" onclick="closeShowTokenModal()">å…³é—­</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç³»ç»Ÿé…ç½®åŒºåŸŸ -->
        <div class="card" id="config-section" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">ç³»ç»Ÿé…ç½®</h2>
                <div class="config-actions">
                    <button id="test-connection-btn" class="btn btn-primary" onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
                    <button id="save-config-btn" class="btn btn-primary" onclick="saveConfiguration()">ä¿å­˜é…ç½®</button>
                </div>
            </div>
            
            <div class="config-container">
                <div class="config-form">
                    <div class="form-group">
                        <div class="label-row">
                            <label for="soar-api-url">SOARæœåŠ¡å™¨APIåœ°å€</label>
                            <small class="form-help">SOARæœåŠ¡å™¨çš„APIåŸºç¡€åœ°å€</small>
                        </div>
                        <input type="url" id="soar-api-url" class="form-input" placeholder="https://hg.wuzhi-ai.com" required>
                    </div>
                    
                    <div class="form-group">
                        <div class="label-row">
                            <label for="soar-api-token">API Token</label>
                            <small class="form-help">ç”¨äºAPIè®¤è¯çš„Token</small>
                        </div>
                        <div class="password-input-container">
                            <input type="password" id="soar-api-token" class="form-input" placeholder="è¾“å…¥API Token" required>
                            <button type="button" class="password-toggle" onclick="togglePasswordVisibility('soar-api-token')">
                                <span class="eye-icon" id="soar-api-token-eye">ğŸ‘ï¸</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="label-row">
                            <label for="soar-timeout">è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰</label>
                            <small class="form-help">APIè¯·æ±‚çš„è¶…æ—¶æ—¶é—´ï¼Œå»ºè®®30-60ç§’</small>
                        </div>
                        <input type="number" id="soar-timeout" class="form-input" min="1" max="300" value="30" required>
                    </div>

                    <div class="form-group">
                        <div class="label-row">
                            <label for="sync-interval">åŒæ­¥å‘¨æœŸ</label>
                            <small class="form-help">å‰§æœ¬å’Œåº”ç”¨çš„è‡ªåŠ¨åŒæ­¥å‘¨æœŸï¼Œé»˜è®¤4å°æ—¶</small>
                        </div>
                        <select id="sync-interval" class="form-input" required>
                            <option value="3600">1å°æ—¶</option>
                            <option value="14400" selected>4å°æ—¶</option>
                            <option value="43200">12å°æ—¶</option>
                            <option value="86400">24å°æ—¶</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <div class="label-row">
                            <label for="label-input">å‰§æœ¬æŠ“å–æ ‡ç­¾</label>
                            <small class="form-help">é»˜è®¤æ ‡ç­¾ï¼šMCPï¼Œå¦‚æœä¸è®¾ç½®æ ‡ç­¾ï¼Œåˆ™åŒæ­¥åå°æ‰€æœ‰å‰§æœ¬ï¼ˆé€‚åˆç¤¾åŒºå…è´¹ç‰ˆOctoMationï¼‰</small>
                        </div>
                        <div class="labels-container">
                            <div class="labels-input">
                                <input type="text" id="label-input" class="form-input" placeholder="è¾“å…¥æ ‡ç­¾åç§°" maxlength="50">
                                <button type="button" id="add-label-btn" class="btn btn-primary" onclick="addLabel()">æ·»åŠ </button>
                            </div>
                            <div class="labels-list" id="labels-list">
                                <!-- æ ‡ç­¾åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="config-status" id="config-status">
                    <h3>é…ç½®çŠ¶æ€</h3>
                    <div class="status-item">
                        <span class="status-label">é…ç½®éªŒè¯:</span>
                        <span class="status-value" id="config-valid">æœªéªŒè¯</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">è¿æ¥æµ‹è¯•:</span>
                        <span class="status-value" id="connection-status">æœªæµ‹è¯•</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">æœ€åæ›´æ–°:</span>
                        <span class="status-value" id="config-updated">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ç»Ÿè®¡ä¿¡æ¯é¡µé¢ -->
        <div class="card" id="stats-section" style="display: none;">
            <div class="card-header">
                <h2 class="card-title">ç»Ÿè®¡ä¿¡æ¯</h2>
                <div class="card-actions">
                    <button class="btn btn-primary" onclick="refreshStats()">åˆ·æ–°ç»Ÿè®¡</button>
                </div>
            </div>
            <div class="card-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>å‰§æœ¬ç»Ÿè®¡</h3>
                        <div class="stat-item">
                            <span class="stat-label">æ€»å‰§æœ¬æ•°ï¼š</span>
                            <span class="stat-value" id="total-playbooks">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">å·²å¯ç”¨ï¼š</span>
                            <span class="stat-value" id="enabled-playbooks">-</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">å·²ç¦ç”¨ï¼š</span>
                            <span class="stat-value" id="disabled-playbooks">-</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <h3>åº”ç”¨ç»Ÿè®¡ï¼ˆæš‚æœªå¼€æ”¾ï¼‰</h3>
                        <div class="stat-item">
                            <span class="stat-label">æ€»åº”ç”¨æ•°ï¼š</span>
                            <span class="stat-value" id="total-apps">-</span>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <h3>ç³»ç»ŸçŠ¶æ€</h3>
                        <div class="stat-item">
                            <span class="stat-label">æœåŠ¡çŠ¶æ€ï¼š</span>
                            <span class="stat-value status-success" id="service-status">è¿è¡Œä¸­</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">æœ€ååŒæ­¥ï¼š</span>
                            <span class="stat-value" id="last-sync">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ£€æŸ¥è®¤è¯çŠ¶æ€
        function checkAuth() {
            const jwt = localStorage.getItem('jwt_token');
            if (!jwt) {
                // å¦‚æœæ²¡æœ‰tokenï¼Œè·³è½¬åˆ°ç™»å½•é¡µ
                window.location.href = '/login';
                return false;
            }
            return jwt;
        }

        // æ³¨é”€å‡½æ•°
        function logout() {
            // ç¡®è®¤æ³¨é”€
            if (confirm('ç¡®å®šè¦æ³¨é”€å—ï¼Ÿ')) {
                // æ¸…é™¤æœ¬åœ°å­˜å‚¨çš„JWT token
                localStorage.removeItem('jwt_token');
                // è·³è½¬åˆ°ç™»å½•é¡µé¢
                window.location.href = '/login';
            }
        }

        // é€šç”¨APIè°ƒç”¨å‡½æ•°ï¼Œè‡ªåŠ¨æ·»åŠ JWTè®¤è¯å¤´
        async function apiCall(url, options = {}) {
            const jwt = checkAuth();
            if (!jwt) return null;

            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${jwt}`
                }
            };

            const mergedOptions = {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...(options.headers || {})
                }
            };

            try {
                const response = await fetch(url, mergedOptions);

                // å¦‚æœè¿”å›401ï¼Œæ¸…é™¤tokenå¹¶è·³è½¬åˆ°ç™»å½•é¡µ
                if (response.status === 401) {
                    localStorage.removeItem('jwt_token');
                    window.location.href = '/login';
                    return null;
                }

                return response;
            } catch (error) {
                console.error('APIè°ƒç”¨å¤±è´¥:', error);
                throw error;
            }
        }

        // å…¨å±€çŠ¶æ€
        let playbooks = [];
        let currentPage = 1;
        const itemsPerPage = 20;
        
        // DOM å…ƒç´ 
        const alertContainer = document.getElementById('alert-container');
        const playbooksTable = document.getElementById('playbooks-tbody');
        const totalCount = document.getElementById('total-count');
        const enabledCount = document.getElementById('enabled-count');
        const disabledCount = document.getElementById('disabled-count');
        const paginationInfo = document.getElementById('pagination-info');
        const prevPageBtn = document.getElementById('prev-page');
        const nextPageBtn = document.getElementById('next-page');
        const pageNumbers = document.getElementById('page-numbers');
        
        // æ˜¾ç¤ºé€šçŸ¥
        function showAlert(message, type = 'success') {
            const alert = document.createElement('div');
            alert.className = type === 'error' ? 'error' : 'success';
            alert.textContent = message;
            alertContainer.innerHTML = '';
            alertContainer.appendChild(alert);

            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        // æ˜¾ç¤ºå¢å¼ºçš„å¤åˆ¶æˆåŠŸæé†’
        function showCopySuccessAlert(message) {
            // åˆ›å»ºç‰¹æ®Šçš„å¤åˆ¶æˆåŠŸæé†’æ¡†
            const copyAlert = document.createElement('div');
            copyAlert.className = 'copy-success-alert';
            copyAlert.innerHTML = `
                <div class="copy-success-content">
                    <span class="copy-success-icon">âœ…</span>
                    <span class="copy-success-text">${message}</span>
                </div>
            `;

            // æ·»åŠ æ ·å¼
            copyAlert.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #10b981 0%, #059669 100%);
                color: white;
                padding: 1.5rem 2rem;
                border-radius: 16px;
                box-shadow: 0 20px 40px rgba(16, 185, 129, 0.4),
                           0 8px 16px rgba(0, 0, 0, 0.2);
                z-index: 10000;
                border: 1px solid rgba(255, 255, 255, 0.2);
                backdrop-filter: blur(10px);
                animation: copySuccessAnimation 0.6s ease-out;
                min-width: 300px;
                text-align: center;
            `;

            // æ·»åŠ åŠ¨ç”»æ ·å¼
            if (!document.getElementById('copy-success-style')) {
                const style = document.createElement('style');
                style.id = 'copy-success-style';
                style.textContent = `
                    @keyframes copySuccessAnimation {
                        0% {
                            opacity: 0;
                            transform: translate(-50%, -50%) scale(0.8);
                        }
                        50% {
                            opacity: 1;
                            transform: translate(-50%, -50%) scale(1.05);
                        }
                        100% {
                            opacity: 1;
                            transform: translate(-50%, -50%) scale(1);
                        }
                    }
                    .copy-success-content {
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 0.75rem;
                    }
                    .copy-success-icon {
                        font-size: 1.5rem;
                    }
                    .copy-success-text {
                        font-size: 1rem;
                        font-weight: 600;
                        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
                    }
                `;
                document.head.appendChild(style);
            }

            // æ·»åŠ åˆ°é¡µé¢å¹¶è‡ªåŠ¨ç§»é™¤
            document.body.appendChild(copyAlert);

            setTimeout(() => {
                copyAlert.style.animation = 'copySuccessAnimation 0.3s ease-out reverse';
                setTimeout(() => {
                    if (copyAlert.parentNode) {
                        copyAlert.remove();
                    }
                }, 300);
            }, 2000);
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            try {
                const date = new Date(dateStr);
                return date.toLocaleString('zh-CN');
            } catch {
                return '-';
            }
        }
        
        // åˆ‡æ¢å‰§æœ¬çŠ¶æ€
        async function togglePlaybook(playbookId, enabled) {
            try {
                const response = await apiCall(`/api/admin/playbooks/${playbookId}/toggle`, {
                    method: 'POST',
                    body: JSON.stringify({ enabled: enabled })
                });

                if (!response) return;
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert(`å‰§æœ¬ ${playbookId} å·²${enabled ? 'å¯ç”¨' : 'ç¦ç”¨'}`, 'success');
                    // æ›´æ–°æœ¬åœ°çŠ¶æ€ (æ³¨æ„ï¼šæ¯”è¾ƒæ—¶ç»Ÿä¸€è½¬æ¢ä¸ºå­—ç¬¦ä¸²)
                    const playbook = playbooks.find(p => String(p.id) === String(playbookId));
                    if (playbook) {
                        playbook.enabled = enabled;
                        updateStats();
                    }
                } else {
                    showAlert(result.error || 'æ“ä½œå¤±è´¥', 'error');
                    // å›æ»šå¼€å…³çŠ¶æ€
                    const toggle = document.querySelector(`input[data-id="${playbookId}"]`);
                    if (toggle) {
                        toggle.checked = !enabled;
                    }
                }
            } catch (error) {
                showAlert('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                // å›æ»šå¼€å…³çŠ¶æ€
                const toggle = document.querySelector(`input[data-id="${playbookId}"]`);
                if (toggle) {
                    toggle.checked = !enabled;
                }
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            const total = playbooks.length;
            const enabled = playbooks.filter(p => p.enabled).length;
            const disabled = total - enabled;
            
            totalCount.textContent = total;
            enabledCount.textContent = enabled;
            disabledCount.textContent = disabled;
        }
        
        // æ¸²æŸ“å‰§æœ¬è¡¨æ ¼
        function renderPlaybooks() {
            if (playbooks.length === 0) {
                playbooksTable.innerHTML = `
                    <tr>
                        <td colspan="4" class="loading">
                            <div>æš‚æ— å‰§æœ¬æ•°æ®</div>
                        </td>
                    </tr>
                `;
                updatePagination();
                return;
            }
            
            // è®¡ç®—åˆ†é¡µæ•°æ®
            const totalPages = Math.ceil(playbooks.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentPlaybooks = playbooks.slice(startIndex, endIndex);
            
            playbooksTable.innerHTML = currentPlaybooks.map(playbook => `
                <tr>
                    <td>
                        <span class="playbook-id" data-id="${playbook.id}">${String(playbook.id)}</span>
                    </td>
                    <td>
                        <div class="playbook-display-name">${playbook.displayName || playbook.name}</div>
                    </td>
                    <td style="white-space:nowrap">${formatDate(playbook.syncTime)}</td>
                    <td>
                        <label class="switch">
                            <input type="checkbox" data-id="${playbook.id}" ${playbook.enabled ? 'checked' : ''}>
                            <span class="slider"></span>
                        </label>
                    </td>
                </tr>
            `).join('');
            
            // ç»‘å®šå¼€å…³äº‹ä»¶
            playbooksTable.querySelectorAll('input[type="checkbox"]').forEach(toggle => {
                toggle.addEventListener('change', (e) => {
                    const playbookId = e.target.dataset.id; // ä¿æŒå­—ç¬¦ä¸²æ ¼å¼é¿å…ç²¾åº¦ä¸¢å¤±
                    const enabled = e.target.checked;
                    togglePlaybook(playbookId, enabled);
                });
            });
            
            // ç»‘å®šå‰§æœ¬IDç‚¹å‡»äº‹ä»¶
            playbooksTable.querySelectorAll('.playbook-id').forEach(playbookIdElement => {
                playbookIdElement.addEventListener('click', (e) => {
                    const playbookId = e.target.dataset.id; // ä¿æŒå­—ç¬¦ä¸²æ ¼å¼é¿å…ç²¾åº¦ä¸¢å¤±
                    showPlaybookDetail(playbookId);
                });
            });
            
            updateStats();
            updatePagination();
        }
        
        // åŠ è½½å‰§æœ¬æ•°æ®
        async function loadPlaybooks() {
            try {
                const response = await apiCall('/api/admin/playbooks');
                if (!response) return;

                const result = await response.json();
                
                if (result.success) {
                    playbooks = result.data;
                    renderPlaybooks();
                } else {
                    showAlert(result.error || 'åŠ è½½å‰§æœ¬æ•°æ®å¤±è´¥', 'error');
                    playbooksTable.innerHTML = `
                        <tr>
                            <td colspan="4" class="loading">
                                <div>åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                showAlert('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                playbooksTable.innerHTML = `
                    <tr>
                        <td colspan="4" class="loading">
                            <div>ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥</div>
                        </td>
                    </tr>
                `;
            }
        }
        
        // æ˜¾ç¤ºå‰§æœ¬è¯¦æƒ…
        async function showPlaybookDetail(playbookId) {
            const modal = document.getElementById('playbook-modal');
            const modalBody = document.getElementById('modal-body');
            
            modal.style.display = 'block';
            modalBody.innerHTML = '<div class="loading">åŠ è½½ä¸­...</div>';
            
            try {
                const response = await apiCall(`/api/admin/playbooks/${playbookId}`);
                if (!response) {
                    modal.style.display = 'none';
                    return;
                }

                const result = await response.json();
                
                if (result.success) {
                    const playbook = result.data;
                    let params = [];
                    
                    // è§£æå‚æ•°
                    if (playbook.playbookParams) {
                        try {
                            params = JSON.parse(playbook.playbookParams);
                        } catch (e) {
                            console.warn('å‚æ•°è§£æå¤±è´¥:', e);
                        }
                    }
                    
                    modalBody.innerHTML = `
                        <div class="detail-row-inline">
                            <div class="detail-section" style="flex:1">
                                <div class="detail-label">å‰§æœ¬ID</div>
                                <div class="detail-value">${String(playbook.id)}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-label">çŠ¶æ€</div>
                                <div class="detail-value">${playbook.enabled ? 'âœ… å·²å¯ç”¨' : 'â›” å·²ç¦ç”¨'}</div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">å‰§æœ¬åç§°</div>
                            <div class="detail-value">${playbook.name}</div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">æ˜¾ç¤ºåç§°</div>
                            <div class="detail-value">${playbook.displayName || playbook.name}</div>
                        </div>
                        
                        <div class="detail-row-inline">
                            <div class="detail-section" style="flex:1">
                                <div class="detail-label">åˆ†ç±»</div>
                                <div class="detail-value">${playbook.playbookCategory}</div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">æè¿°</div>
                            <div class="detail-value">${playbook.description || 'æ— æè¿°'}</div>
                        </div>
                        
                        <div class="detail-timestamps">
                            <div class="detail-section">
                                <div class="detail-label">åˆ›å»ºæ—¶é—´</div>
                                <div class="detail-value" style="white-space:nowrap">${formatDate(playbook.createTime)}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-label">æ›´æ–°æ—¶é—´</div>
                                <div class="detail-value" style="white-space:nowrap">${formatDate(playbook.updateTime)}</div>
                            </div>
                            <div class="detail-section">
                                <div class="detail-label">æœ€ååŒæ­¥</div>
                                <div class="detail-value" style="white-space:nowrap">${formatDate(playbook.syncTime)}</div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-label">å‚æ•°ä¿¡æ¯ (${params.length} ä¸ª)</div>
                            <div class="detail-value">
                                ${params.length === 0 ? 'æ— å‚æ•°' : params.map(param => `
                                    <div class="param-item">
                                        <div class="param-name">
                                            ${param.cefColumn || param.key || 'æœªçŸ¥å‚æ•°'}
                                            <span class="param-type">${param.valueType || param.type || 'string'}</span>
                                            ${param.required ? '<span class="param-required">å¿…å¡«</span>' : ''}
                                        </div>
                                        ${param.cefDesc ? `<div class="param-description">${param.cefDesc}</div>` : ''}
                                        ${param.description ? `<div class="param-description">${param.description}</div>` : ''}
                                        ${param.defaultValue ? `<div class="param-description">é»˜è®¤å€¼: ${param.defaultValue}</div>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    modalBody.innerHTML = `<div class="error">åŠ è½½å¤±è´¥: ${result.error || 'æœªçŸ¥é”™è¯¯'}</div>`;
                }
            } catch (error) {
                modalBody.innerHTML = `<div class="error">ç½‘ç»œé”™è¯¯: ${error.message}</div>`;
            }
        }
        
        // å…³é—­Modal
        function closeModal() {
            document.getElementById('playbook-modal').style.display = 'none';
        }
        
        // æ›´æ–°åˆ†é¡µä¿¡æ¯å’Œæ§ä»¶
        function updatePagination() {
            const totalPages = Math.ceil(playbooks.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, playbooks.length);
            
            // æ›´æ–°åˆ†é¡µä¿¡æ¯
            if (playbooks.length === 0) {
                paginationInfo.textContent = 'æ˜¾ç¤ºç¬¬ 0-0 æ¡ï¼Œå…± 0 æ¡';
            } else {
                paginationInfo.textContent = `æ˜¾ç¤ºç¬¬ ${startIndex + 1}-${endIndex} æ¡ï¼Œå…± ${playbooks.length} æ¡`;
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages || totalPages === 0;
            
            // ç”Ÿæˆé¡µç 
            renderPageNumbers(totalPages);
        }
        
        // æ¸²æŸ“é¡µç 
        function renderPageNumbers(totalPages) {
            pageNumbers.innerHTML = '';
            
            if (totalPages <= 1) {
                return;
            }
            
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            // æ˜¾ç¤ºç¬¬ä¸€é¡µå’Œçœç•¥å·
            if (startPage > 1) {
                pageNumbers.appendChild(createPageButton(1));
                if (startPage > 2) {
                    pageNumbers.appendChild(createEllipsis());
                }
            }
            
            // æ˜¾ç¤ºé¡µç 
            for (let page = startPage; page <= endPage; page++) {
                pageNumbers.appendChild(createPageButton(page));
            }
            
            // æ˜¾ç¤ºçœç•¥å·å’Œæœ€åä¸€é¡µ
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    pageNumbers.appendChild(createEllipsis());
                }
                pageNumbers.appendChild(createPageButton(totalPages));
            }
        }
        
        // åˆ›å»ºé¡µç æŒ‰é’®
        function createPageButton(page) {
            const button = document.createElement('div');
            button.className = `page-number ${page === currentPage ? 'active' : ''}`;
            button.textContent = page;
            button.onclick = () => goToPage(page);
            return button;
        }
        
        // åˆ›å»ºçœç•¥å·
        function createEllipsis() {
            const ellipsis = document.createElement('div');
            ellipsis.className = 'page-number ellipsis';
            ellipsis.textContent = '...';
            return ellipsis;
        }
        
        // è·³è½¬åˆ°æŒ‡å®šé¡µ
        function goToPage(page) {
            if (page >= 1 && page <= Math.ceil(playbooks.length / itemsPerPage)) {
                currentPage = page;
                renderPlaybooks();
            }
        }
        
        // ç‚¹å‡»ModalèƒŒæ™¯å…³é—­
        function setupModalEvents() {
            const modal = document.getElementById('playbook-modal');
            const closeBtn = document.getElementById('close-modal-btn');
            
            // å…³é—­æŒ‰é’®äº‹ä»¶
            closeBtn.addEventListener('click', closeModal);
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            modal.addEventListener('click', function(event) {
                if (event.target === modal) {
                    closeModal();
                }
            });
        }
        
        // å¯†ç æ˜¾ç¤º/éšè—åŠŸèƒ½
        function togglePasswordVisibility(inputId) {
            const input = document.getElementById(inputId);
            const eyeIcon = document.getElementById(inputId + '-eye');
            
            if (input.type === 'password') {
                input.type = 'text';
                eyeIcon.textContent = 'ğŸ™ˆ';
            } else {
                input.type = 'password';
                eyeIcon.textContent = 'ğŸ‘ï¸';
            }
        }
        
        // æµ‹è¯•è¿æ¥åŠŸèƒ½
        async function testConnection() {
            const testBtn = document.getElementById('test-connection-btn');
            const connectionStatus = document.getElementById('connection-status');
            
            testBtn.disabled = true;
            testBtn.textContent = 'æµ‹è¯•ä¸­...';
            connectionStatus.textContent = 'æµ‹è¯•ä¸­...';
            connectionStatus.className = 'status-warning';
            
            try {
                const response = await apiCall('/api/admin/config/test', {
                    method: 'POST',
                    body: JSON.stringify({}) // å‘é€ç©ºå¯¹è±¡ï¼Œä½¿ç”¨å½“å‰æ•°æ®åº“é…ç½®
                });

                if (!response) return;
                
                const data = await response.json();
                
                if (data.success) {
                    connectionStatus.textContent = 'è¿æ¥æˆåŠŸ';
                    connectionStatus.className = 'status-success';
                    showAlert('APIè¿æ¥æµ‹è¯•æˆåŠŸï¼', 'success');
                } else {
                    connectionStatus.textContent = 'è¿æ¥å¤±è´¥';
                    connectionStatus.className = 'status-error';
                    showAlert(`è¿æ¥æµ‹è¯•å¤±è´¥: ${data.message}`, 'error');
                }
            } catch (error) {
                connectionStatus.textContent = 'è¿æ¥å¤±è´¥';
                connectionStatus.className = 'status-error';
                showAlert(`è¿æ¥æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
            
            testBtn.disabled = false;
            testBtn.textContent = 'æµ‹è¯•è¿æ¥';
        }
        
        // ä¿å­˜é…ç½®åŠŸèƒ½
        async function saveConfiguration() {
            const saveBtn = document.getElementById('save-config-btn');
            const configValid = document.getElementById('config-valid');
            const configUpdated = document.getElementById('config-updated');
            
            saveBtn.disabled = true;
            saveBtn.textContent = 'ä¿å­˜ä¸­...';
            
            // æ”¶é›†é…ç½®æ•°æ®
            const apiUrl = document.getElementById('soar-api-url').value.trim();
            const apiToken = document.getElementById('soar-api-token').value.trim();
            const timeout = parseInt(document.getElementById('soar-timeout').value);
            const syncInterval = parseInt(document.getElementById('sync-interval').value);

            // æ”¶é›†æ ‡ç­¾
            const labelElements = document.querySelectorAll('.label-tag .label-name');
            const labels = Array.from(labelElements).map(el => el.textContent.trim()).filter(label => label);

            // æ„å»ºé…ç½®æ•°æ®
            const configData = {
                soar_api_url: apiUrl,
                soar_timeout: timeout,
                sync_interval: syncInterval,
                soar_labels: labels
            };
            
            // æ£€æŸ¥Tokenæ˜¯å¦è¢«ä¿®æ”¹ï¼ˆå¦‚æœä¸æ˜¯æ‰“ç æ ¼å¼ï¼Œè¯´æ˜ç”¨æˆ·è¾“å…¥äº†æ–°Tokenï¼‰
            if (!apiToken.includes('***')) {
                configData.soar_api_token = apiToken;
            }
            // å¦‚æœæ˜¯æ‰“ç æ ¼å¼ï¼Œåˆ™ä¸åŒ…å«Tokenå­—æ®µï¼Œåç«¯ä¼šä¿æŒåŸæœ‰Token
            
            // éªŒè¯å¿…å¡«é¡¹
            if (!apiUrl || !apiToken || !timeout) {
                showAlert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹', 'error');
                saveBtn.disabled = false;
                saveBtn.textContent = 'ä¿å­˜é…ç½®';
                return;
            }
            
            try {
                const response = await apiCall('/api/admin/config', {
                    method: 'POST',
                    body: JSON.stringify(configData)
                });

                if (!response) return;
                
                const data = await response.json();
                
                if (data.success) {
                    configValid.textContent = 'é…ç½®æœ‰æ•ˆ';
                    configValid.className = 'status-success';
                    configUpdated.textContent = new Date().toLocaleString('zh-CN');
                    showAlert('é…ç½®ä¿å­˜æˆåŠŸï¼', 'success');
                } else {
                    configValid.textContent = 'é…ç½®æ— æ•ˆ';
                    configValid.className = 'status-error';
                    showAlert(`é…ç½®ä¿å­˜å¤±è´¥: ${data.message}`, 'error');
                }
            } catch (error) {
                configValid.textContent = 'é…ç½®æ— æ•ˆ';
                configValid.className = 'status-error';
                showAlert(`é…ç½®ä¿å­˜å¤±è´¥: ${error.message}`, 'error');
            }
            
            saveBtn.disabled = false;
            saveBtn.textContent = 'ä¿å­˜é…ç½®';
        }
        
        // æ ‡ç­¾ç®¡ç†åŠŸèƒ½
        function addLabel() {
            const labelInput = document.getElementById('label-input');
            const labelsList = document.getElementById('labels-list');
            const labelName = labelInput.value.trim();
            
            if (!labelName) {
                showAlert('è¯·è¾“å…¥æ ‡ç­¾åç§°', 'warning');
                return;
            }
            
            // æ£€æŸ¥é‡å¤
            const existingLabels = Array.from(document.querySelectorAll('.label-tag .label-name'))
                .map(el => el.textContent.trim());
            
            if (existingLabels.includes(labelName)) {
                showAlert('æ ‡ç­¾å·²å­˜åœ¨', 'warning');
                return;
            }
            
            // åˆ›å»ºæ ‡ç­¾å…ƒç´ 
            const labelElement = document.createElement('div');
            labelElement.className = 'label-tag';
            labelElement.innerHTML = `
                <span class="label-name">${labelName}</span>
                <button type="button" class="label-remove" onclick="this.parentElement.remove()">Ã—</button>
            `;
            
            labelsList.appendChild(labelElement);
            labelInput.value = '';
        }
        
        // åˆå§‹åŒ–
        // åŠ è½½ç³»ç»Ÿé…ç½®
        async function loadSystemConfig() {
            try {
                const response = await apiCall('/api/admin/config');
                if (!response) return;

                const data = await response.json();
                
                if (data.success && data.data) {
                    // å¡«å……è¡¨å•å­—æ®µ
                    document.getElementById('soar-api-url').value = data.data.soar_api_url || '';
                    document.getElementById('soar-api-token').value = data.data.soar_api_token || '';
                    document.getElementById('soar-timeout').value = data.data.soar_timeout || 30;
                    document.getElementById('sync-interval').value = data.data.sync_interval || 14400;
                    
                    // å¡«å……æ ‡ç­¾åˆ—è¡¨
                    const labelsList = document.getElementById('labels-list');
                    labelsList.innerHTML = '';
                    
                    const labels = data.data.soar_labels && Array.isArray(data.data.soar_labels)
                        ? data.data.soar_labels
                        : ["MCP"]; // é»˜è®¤MCPæ ‡ç­¾
                    
                    labels.forEach(label => {
                        const labelElement = document.createElement('div');
                        labelElement.className = 'label-tag';
                        labelElement.innerHTML = `
                            <span class="label-name">${label}</span>
                            <button type="button" class="label-remove" onclick="this.parentElement.remove()">Ã—</button>
                        `;
                        labelsList.appendChild(labelElement);
                    });
                }
            } catch (error) {
                console.error('åŠ è½½ç³»ç»Ÿé…ç½®å¤±è´¥:', error);
                showAlert('åŠ è½½ç³»ç»Ÿé…ç½®å¤±è´¥', 'error');

                // å³ä½¿åŠ è½½å¤±è´¥ï¼Œä¹Ÿæ˜¾ç¤ºé»˜è®¤çš„MCPæ ‡ç­¾
                const labelsList = document.getElementById('labels-list');
                labelsList.innerHTML = '';
                const labelElement = document.createElement('div');
                labelElement.className = 'label-tag';
                labelElement.innerHTML = `
                    <span class="label-name">MCP</span>
                    <button type="button" class="label-remove" onclick="this.parentElement.remove()">Ã—</button>
                `;
                labelsList.appendChild(labelElement);
            }
        }

        // Tokenç®¡ç†åŠŸèƒ½
        let tokens = [];

        // åŠ è½½Tokenåˆ—è¡¨
        async function loadTokens() {
            try {
                const response = await apiCall('/api/admin/tokens');
                if (!response) return;

                const result = await response.json();

                if (result.success) {
                    tokens = result.data;
                    renderTokens();
                } else {
                    showAlert(result.error || 'åŠ è½½Tokenæ•°æ®å¤±è´¥', 'error');
                    document.getElementById('tokens-tbody').innerHTML = `
                        <tr>
                            <td colspan="7" class="loading">
                                <div>åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                showAlert('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                document.getElementById('tokens-tbody').innerHTML = `
                    <tr>
                        <td colspan="7" class="loading">
                            <div>ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥è¿æ¥</div>
                        </td>
                    </tr>
                `;
            }
        }

        // æ¸²æŸ“Tokenè¡¨æ ¼
        function renderTokens() {
            const tokensTable = document.getElementById('tokens-tbody');

            if (tokens.length === 0) {
                tokensTable.innerHTML = `
                    <tr>
                        <td colspan="7" class="loading">
                            <div>æš‚æ— Tokenæ•°æ®</div>
                        </td>
                    </tr>
                `;
                return;
            }

            tokensTable.innerHTML = tokens.map(token => {
                const isExpired = token.expires_at && new Date(token.expires_at) < new Date();
                const maskedToken = token.token.substring(0, 8) + '***' + token.token.substring(token.token.length - 4);

                return `
                    <tr>
                        <td>${token.name}</td>
                        <td>
                            <span class="playbook-id" style="font-size: 0.8rem; cursor: default;">${maskedToken}</span>
                        </td>
                        <td style="white-space: nowrap; font-size: 0.85rem;">${formatDate(token.created_at)}</td>
                        <td style="white-space: nowrap; font-size: 0.85rem;">${token.expires_at ? formatDate(token.expires_at) : 'æ°¸ä¸è¿‡æœŸ'}</td>
                        <td style="white-space: nowrap; font-size: 0.85rem;">${formatDate(token.last_used_at)}</td>
                        <td>
                            <span style="color: ${isExpired ? '#fca5a5' : (token.is_active ? '#ffffff' : '#d1d5db')}; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);">
                                ${isExpired ? 'å·²è¿‡æœŸ' : (token.is_active ? 'æ´»è·ƒ' : 'ç¦ç”¨')}
                            </span>
                        </td>
                        <td>
                            <button class="btn btn-secondary" style="padding: 0.25rem 0.5rem; font-size: 0.75rem;"
                                    onclick="deleteToken(${token.id})">åˆ é™¤</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        // æ˜¾ç¤ºåˆ›å»ºTokenæ¨¡æ€æ¡†
        function showCreateTokenModal() {
            document.getElementById('create-token-modal').style.display = 'block';
            document.getElementById('token-name').value = '';
            document.getElementById('token-expires').value = '';
        }

        // å…³é—­åˆ›å»ºTokenæ¨¡æ€æ¡†
        function closeCreateTokenModal() {
            document.getElementById('create-token-modal').style.display = 'none';
        }

        // åˆ›å»ºToken
        async function createToken() {
            const name = document.getElementById('token-name').value.trim();
            const expiresInDays = document.getElementById('token-expires').value;

            if (!name) {
                showAlert('è¯·è¾“å…¥Tokenåç§°', 'error');
                return;
            }

            try {
                const response = await apiCall('/api/admin/tokens', {
                    method: 'POST',
                    body: JSON.stringify({
                        name: name,
                        expires_in_days: expiresInDays ? parseInt(expiresInDays) : null
                    })
                });

                if (!response) return;

                const result = await response.json();

                if (result.success) {
                    closeCreateTokenModal();

                    // æ˜¾ç¤ºæ–°åˆ›å»ºçš„Tokenå€¼
                    document.getElementById('new-token-value').value = result.token;

                    // ç”Ÿæˆå®Œæ•´çš„MCP URL
                    const currentHost = window.location.host;
                    const mcpUrl = `http://${currentHost.replace(':12346', ':12345')}/mcp?token=${result.token}`;
                    document.getElementById('new-mcp-url').value = mcpUrl;

                    document.getElementById('show-token-modal').style.display = 'block';

                    // é‡æ–°åŠ è½½Tokenåˆ—è¡¨
                    loadTokens();
                    showAlert('Tokenåˆ›å»ºæˆåŠŸï¼', 'success');
                } else {
                    showAlert(result.error || 'Tokenåˆ›å»ºå¤±è´¥', 'error');
                }
            } catch (error) {
                showAlert('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
            }
        }

        // å…³é—­æ˜¾ç¤ºTokenå€¼æ¨¡æ€æ¡†
        function closeShowTokenModal() {
            document.getElementById('show-token-modal').style.display = 'none';
            document.getElementById('new-token-value').value = '';
            document.getElementById('new-mcp-url').value = '';
        }

        // å¤åˆ¶Tokenåˆ°å‰ªè´´æ¿
        async function copyTokenToClipboard() {
            const tokenInput = document.getElementById('new-token-value');
            try {
                await navigator.clipboard.writeText(tokenInput.value);
                showCopySuccessAlert('Tokenå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            } catch (error) {
                // å…¼å®¹æ—§æµè§ˆå™¨
                tokenInput.select();
                document.execCommand('copy');
                showCopySuccessAlert('Tokenå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }
        }

        // å¤åˆ¶MCP URLåˆ°å‰ªè´´æ¿
        async function copyMcpUrlToClipboard() {
            const mcpUrlInput = document.getElementById('new-mcp-url');
            try {
                await navigator.clipboard.writeText(mcpUrlInput.value);
                showCopySuccessAlert('MCP URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            } catch (error) {
                // å…¼å®¹æ—§æµè§ˆå™¨
                mcpUrlInput.select();
                document.execCommand('copy');
                showCopySuccessAlert('MCP URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }
        }

        // åˆ é™¤Token
        async function deleteToken(tokenId) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªTokenå—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) {
                return;
            }

            try {
                const response = await apiCall(`/api/admin/tokens/${tokenId}`, {
                    method: 'DELETE'
                });

                if (!response) return;

                const result = await response.json();

                if (result.success) {
                    showAlert('Tokenåˆ é™¤æˆåŠŸ', 'success');
                    loadTokens(); // é‡æ–°åŠ è½½Tokenåˆ—è¡¨
                } else {
                    showAlert(result.error || 'Tokenåˆ é™¤å¤±è´¥', 'error');
                }
            } catch (error) {
                showAlert('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
            }
        }

        // å°†refreshStatså®šä¹‰ä¸ºå…¨å±€å‡½æ•°
        function refreshStats() {
            // è·å–æ‰€æœ‰ç»Ÿè®¡ä¿¡æ¯ï¼ˆåŒ…æ‹¬å‰§æœ¬å’Œåº”ç”¨ç»Ÿè®¡ï¼‰
            apiCall('/api/admin/stats')
                .then(response => {
                    if (!response) return;
                    return response.json();
                })
                .then(data => {
                    if (!data) return;
                    if (data.success && data.stats) {
                        // æ›´æ–°å‰§æœ¬ç»Ÿè®¡
                        document.getElementById('total-playbooks').textContent = data.stats.total_playbooks || '-';
                        document.getElementById('enabled-playbooks').textContent = data.stats.enabled_playbooks || '-';
                        document.getElementById('disabled-playbooks').textContent = data.stats.disabled_playbooks || '-';
                        
                        // æ›´æ–°åº”ç”¨ç»Ÿè®¡
                        document.getElementById('total-apps').textContent = data.stats.total_apps || '-';
                        
                        // æ›´æ–°æœ€ååŒæ­¥æ—¶é—´
                        if (data.stats.last_sync_time) {
                            // ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œé¿å…æ—¶åŒºè½¬æ¢é—®é¢˜
                            document.getElementById('last-sync').textContent = data.stats.last_sync_time;
                        }
                    }
                })
                .catch(error => console.error('Error fetching stats:', error));
        }
        
        // Tabåˆ‡æ¢åŠŸèƒ½
        function showTab(tabName) {
            // éšè—æ‰€æœ‰section
            document.getElementById('playbooks-section').style.display = 'none';
            document.getElementById('tokens-section').style.display = 'none';
            document.getElementById('config-section').style.display = 'none';
            document.getElementById('stats-section').style.display = 'none';

            // ç§»é™¤æ‰€æœ‰å¯¼èˆªé¡¹çš„activeç±»
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // æ˜¾ç¤ºå¯¹åº”çš„section
            if (tabName === 'playbooks') {
                document.getElementById('playbooks-section').style.display = 'block';
                document.getElementById('nav-playbooks').classList.add('active');
            } else if (tabName === 'tokens') {
                document.getElementById('tokens-section').style.display = 'block';
                document.getElementById('nav-tokens').classList.add('active');
                loadTokens(); // åŠ è½½Tokenåˆ—è¡¨
            } else if (tabName === 'config') {
                document.getElementById('config-section').style.display = 'block';
                document.getElementById('nav-config').classList.add('active');
                loadSystemConfig(); // åŠ è½½ç³»ç»Ÿé…ç½®
            } else if (tabName === 'stats') {
                document.getElementById('stats-section').style.display = 'block';
                document.getElementById('nav-stats').classList.add('active');
                refreshStats(); // åˆ·æ–°ç»Ÿè®¡ä¿¡æ¯
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥è®¤è¯
            if (!checkAuth()) {
                return; // checkAuthä¼šå¤„ç†è·³è½¬
            }

            // æ·»åŠ å¯¼èˆªäº‹ä»¶ç›‘å¬å™¨
            document.getElementById('nav-playbooks').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('playbooks');
            });

            document.getElementById('nav-tokens').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('tokens');
            });

            document.getElementById('nav-config').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('config');
            });

            document.getElementById('nav-stats').addEventListener('click', (e) => {
                e.preventDefault();
                showTab('stats');
            });

            // æ³¨é”€æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
            document.getElementById('logout-btn').addEventListener('click', (e) => {
                e.preventDefault();
                logout();
            });
            setupModalEvents();
            
            // è®¾ç½®åˆ†é¡µæŒ‰é’®äº‹ä»¶
            prevPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    goToPage(currentPage - 1);
                }
            });
            
            nextPageBtn.addEventListener('click', () => {
                const totalPages = Math.ceil(playbooks.length / itemsPerPage);
                if (currentPage < totalPages) {
                    goToPage(currentPage + 1);
                }
            });
            
            loadPlaybooks();
            
            // å®šæœŸåˆ·æ–°ï¼ˆæ¯30ç§’ï¼‰
            setInterval(loadPlaybooks, 30000);

            // æ·»åŠ ç»ç’ƒæ‹Ÿæ€äº¤äº’æ•ˆæœ
            initGlassmorphismEffects();
        });

        // åˆå§‹åŒ–äº¤äº’æ•ˆæœï¼ˆè½»é‡çº§ï¼‰
        function initGlassmorphismEffects() {
            // ä¿æŒè½»é‡ï¼Œæ— é¢å¤–è£…é¥°æ•ˆæœ
        }
    </script>

    <!-- åº•éƒ¨ä¿¡æ¯ -->
    <footer class="footer">
        <div class="footer-content">
            é›¾å¸œæ™ºèƒ½ &copy; 2025
            <a href="https://flagify.com" target="_blank">Flagify</a>
            <a href="https://github.com/flagify-com/OctoMation/wiki" target="_blank">OctoMation</a>
            &middot;
            <a href="https://github.com/flagify-com/soar-mcp" target="_blank">GitHub</a>
        </div>
    </footer>
</body>
</html>